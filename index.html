<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>MCOT Phitsanulok Package Manager</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* ===== Sidebar แบบคลิกขอบซ้าย (Photoshop Style) ===== */
        #sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 64px;
            background: linear-gradient(135deg, #0d3b66 0%, #1c5bb8 100%);
            color: white;
            z-index: 50;
            transition: width 0.3s ease;
            overflow: hidden;
            white-space: nowrap;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        #sidebar.expanded {
            width: 256px;
        }
        
        .sidebar-trigger {
            position: fixed;
            left: 0;
            top: 0;
            width: 14px;
            height: 100vh;
            background: transparent;
            z-index: 100;
            cursor: pointer;
        }
        
        .sidebar-trigger:hover {
            background: rgba(37, 99, 235, 0.1);
        }
        
        .sidebar-trigger::after {
            content: '';
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .sidebar-trigger:hover::after {
            background: #f9a826;
            width: 6px;
            left: 3px;
            height: 60px;
        }
        
        #sidebar:not(.expanded) .sidebar-text {
            display: none;
        }
        
        #sidebar:not(.expanded) .menu-item {
            justify-content: center;
            padding: 14px 0;
        }
        
        #sidebar:not(.expanded) .menu-item i {
            margin: 0;
            font-size: 1.3rem;
        }
        
        #sidebar:not(.expanded) .sidebar-header h1,
        #sidebar:not(.expanded) .sidebar-header p,
        #sidebar:not(.expanded) .command-title,
        #sidebar:not(.expanded) .footer-text {
            display: none;
        }
        
        #sidebar:not(.expanded) .sidebar-header {
            padding: 20px 0;
        }
        
        #sidebar:not(.expanded) .sidebar-header .logo {
            margin: 0 auto;
            width: 42px;
            height: 42px;
            padding: 8px;
        }
        
        #main-content {
            margin-left: 64px;
            transition: margin-left 0.3s ease, width 0.3s ease;
            width: calc(100% - 64px);
        }
        
        #main-content.expanded {
            margin-left: 256px;
            width: calc(100% - 256px);
        }
        
        /* ===== Mobile Menu ปรับปรุงใหม่ ===== */
        @media (max-width: 768px) {
            /* ซ่อน Sidebar ปกติ */
            #sidebar {
                transform: translateX(-100%);
                width: 280px !important;
                box-shadow: 4px 0 20px rgba(0,0,0,0.3);
                transition: transform 0.3s ease;
                z-index: 1000;
            }
            
            #sidebar.expanded {
                transform: translateX(0) !important;
            }
            
            #main-content,
            #main-content.expanded {
                margin-left: 0 !important;
                width: 100% !important;
            }
            
            /* ซ่อนพื้นที่คลิกขอบ */
            .sidebar-trigger { 
                display: none; 
            }
            
            /* ปุ่มเมนูมือถือ - ปรับให้ใหญ่ขึ้น กดง่าย */
            .mobile-menu-btn {
                display: flex !important;
                position: fixed;
                top: 16px;
                left: 16px;
                z-index: 1001;
                background: linear-gradient(135deg, #0d3b66 0%, #1c5bb8 100%);
                color: white;
                border: none;
                border-radius: 12px;
                padding: 16px 18px;
                cursor: pointer;
                box-shadow: 0 6px 15px rgba(0,0,0,0.2);
                font-size: 1.4rem;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
                border: 2px solid rgba(255,255,255,0.2);
            }
            
            .mobile-menu-btn:active {
                transform: scale(0.95);
                background: #1c5bb8;
            }
            
            /* Overlay สำหรับปิดเมนู */
            .mobile-menu-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
                backdrop-filter: blur(3px);
            }
            
            .mobile-menu-overlay.active {
                display: block !important;
            }
            
            /* ปรับพื้นที่เนื้อหาหลัก */
            #main-content {
                padding-top: 70px !important;
            }
            
            /* ปรับขนาดฟอนต์และ padding สำหรับมือถือ */
            .mobile-text-sm { font-size: 0.875rem !important; }
            .mobile-text-base { font-size: 1rem !important; }
            .mobile-text-lg { font-size: 1.125rem !important; }
            .mobile-p-3 { padding: 0.75rem !important; }
            .mobile-p-4 { padding: 1rem !important; }
            .mobile-mt-4 { margin-top: 1rem !important; }
            .mobile-w-full { width: 100% !important; }
            
            /* ปุ่มต่างๆ ในมือถือ */
            .btn-mobile {
                width: 100%;
                justify-content: center;
                margin: 0.25rem 0;
            }
            
            /* ตารางในมือถือ */
            .table-container {
                margin: 0 -0.5rem;
                width: calc(100% + 1rem);
            }
            
            /* การ์ดต่างๆ */
            .card-mobile {
                padding: 0.75rem !important;
            }
            
            /* ปรับฟอร์ม */
            input, select, textarea {
                font-size: 16px !important; /* ป้องกัน zoom บน iOS */
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-btn { 
                display: none !important; 
            }
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: white;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            width: 100%;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .menu-item:hover { background: rgba(255, 255, 255, 0.15); }
        .menu-item.active {
            border-left-color: #f9a826;
            background: rgba(255, 255, 255, 0.2);
        }
        .menu-item i { width: 24px; text-align: center; font-size: 1.1rem; }
        
        .sidebar-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .logo {
            background: white;
            padding: 10px;
            border-radius: 18px;
            margin-bottom: 12px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .logo i { font-size: 1.8rem; color: #1c5bb8; }
        
        .command-title {
            font-size: 10px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 8px;
            padding-left: 4px;
        }
        
        .footer-text {
            font-size: 10px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 500;
            line-height: 1.5;
        }
        
        h1, h2, h3, h4, h5, h6 { font-family: 'Prompt', sans-serif; }
        .mcot-gradient { background: linear-gradient(135deg, #0d3b66 0%, #1c5bb8 100%); }
        .gold-border { border-color: #f9a826; }
        
        .animate-fadeIn { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; font-size: 12pt; }
            .print-only { display: block !important; }
            .print-report {
                display: block !important;
                width: 100%;
                margin: 0;
                padding: 0.5in;
            }
            .print-report table {
                width: 100%;
                border-collapse: collapse;
                page-break-inside: avoid;
            }
            .print-report th {
                background-color: #e2e8f0 !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .print-report h2 { color: #1e40af !important; }
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .time-slot-btn { transition: all 0.2s; }
        .time-slot-btn.selected {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }
        .weekday-btn { transition: all 0.2s; }
        .weekday-btn.selected { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .order-type-btn.active {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            color: #2563eb;
        }
        
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        
        .quotation-header { border-bottom: 2px solid #1e293b; margin-bottom: 1.5rem; }
        .quotation-line { border-top: 1px solid #cbd5e1; margin: 0.5rem 0; }
        .quotation-section { margin-bottom: 1rem; }
        
        .product-category-tab { transition: all 0.2s; }
        .product-category-tab.active {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .package-product-item { transition: all 0.2s; }
        .package-product-item.selected {
            background-color: #eff6ff;
            border-color: #2563eb;
            border-width: 2px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: fadeIn 0.3s ease-out;
        }
        
        .report-container { display: none; }
        .report-container.print-active { display: block; }
        .form-hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- พื้นที่คลิกขอบซ้าย สำหรับ Desktop -->
    <div id="sidebar-trigger" class="sidebar-trigger" onclick="toggleSidebar()"></div>
    
    <!-- ปุ่มเมนูมือถือ (ออกแบบใหม่) -->
    <button id="mobile-menu-btn" class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
    
    <!-- Navigation Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 h-screen mcot-gradient text-white z-50 no-print">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-broadcast-tower"></i>
            </div>
            <h1 class="text-base font-bold text-center sidebar-text">MCOT Package</h1>
            <p class="text-xs opacity-70 mt-1 sidebar-text">FM 106.25 Phitsanulok</p>
        </div>
        
        <nav class="py-4 overflow-y-auto" style="height: calc(100vh - 180px);">
            <button onclick="switchTab('customers'); closeMobileMenu();" class="menu-item" data-tab="customers">
                <i class="fas fa-users"></i>
                <span class="sidebar-text">Customer</span>
                <span id="customer-badge" class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold hidden sidebar-text">0</span>
            </button>
            
            <button onclick="switchTab('products'); closeMobileMenu();" class="menu-item" data-tab="products">
                <i class="fas fa-box"></i>
                <span class="sidebar-text">Product</span>
            </button>
            
            <button onclick="switchTab('packages'); closeMobileMenu();" class="menu-item" data-tab="packages">
                <i class="fas fa-boxes"></i>
                <span class="sidebar-text">Package</span>
            </button>
            
            <button onclick="switchTab('orders'); closeMobileMenu();" class="menu-item" data-tab="orders">
                <i class="fas fa-shopping-cart"></i>
                <span class="sidebar-text">Order</span>
                <span id="order-badge" class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold hidden sidebar-text">0</span>
            </button>
            
            <button onclick="switchTab('quotations'); closeMobileMenu();" class="menu-item" data-tab="quotations">
                <i class="fas fa-file-invoice-dollar"></i>
                <span class="sidebar-text">Quotation</span>
            </button>
            
            <button onclick="switchTab('report'); closeMobileMenu();" class="menu-item" data-tab="report">
                <i class="fas fa-chart-bar"></i>
                <span class="sidebar-text">Report</span>
            </button>
        </nav>
        
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-white/10 bg-black/10">
            <p class="command-title sidebar-text">คำสั่งหลัก</p>
            <button onclick="saveData()" class="w-full flex items-center justify-center gap-2 bg-emerald-500 hover:bg-emerald-600 text-white py-2 rounded-lg text-sm font-semibold shadow-md transition-all active:scale-95 mb-2">
                <i class="fas fa-save"></i>
                <span class="sidebar-text">Save</span>
            </button>
            
            <div class="grid grid-cols-2 gap-2 mb-2">
                <button onclick="exportData()" class="flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-400 text-white py-2 rounded-lg text-xs font-semibold shadow-md transition-all active:scale-95">
                    <i class="fas fa-download"></i>
                    <span class="sidebar-text">Export</span>
                </button>
                <button onclick="document.getElementById('import-file').click()" class="flex items-center justify-center gap-2 bg-indigo-500 hover:bg-indigo-400 text-white py-2 rounded-lg text-xs font-semibold shadow-md transition-all active:scale-95">
                    <i class="fas fa-upload"></i>
                    <span class="sidebar-text">Import</span>
                </button>
                <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(event)">
            </div>
            
            <button onclick="clearData()" class="w-full flex items-center justify-center gap-2 bg-rose-600 hover:bg-rose-700 text-white py-2 rounded-lg text-xs font-semibold shadow-md transition-all active:scale-95">
                <i class="fas fa-trash"></i>
                <span class="sidebar-text">Clear All</span>
            </button>
            
            <div class="pt-2">
                <p class="footer-text sidebar-text">
                    By Suraphun Inopas@2026 V4.0
                </p>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <main id="main-content" class="p-4 lg:p-8 xl:p-12 transition-all min-h-screen">
        <header class="mb-6 lg:mb-10 no-print">
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-end gap-4">
                <div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">MCOT Phitsanulok FM 106.25</p>
                    <h1 id="page-title" class="text-2xl lg:text-4xl font-black text-slate-900 tracking-tight capitalize mobile-text-lg">ระบบจัดการแพ็กเกจ</h1>
                </div>
                <div class="text-[10px] text-slate-400 font-mono text-right italic">
                    บันทึกล่าสุด: <span id="last-saved">ยังไม่เคยบันทึก</span>
                </div>
            </div>
        </header>
        
        <!-- ========== CUSTOMERS TAB ========== -->
        <div id="customers-tab" class="tab-content animate-fadeIn hidden">
            <div class="space-y-6 lg:space-y-8">
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 bg-slate-50/50">
                        <div class="flex items-center gap-3">
                            <div class="bg-blue-100 p-2 rounded-lg text-blue-600"><i class="fas fa-briefcase text-xl"></i></div>
                            <h2 class="text-lg lg:text-xl font-bold">รายชื่อลูกค้า (<span id="customer-count">0</span>)</h2>
                        </div>
                        <div class="flex gap-2">
                            <div class="relative w-full md:w-64">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" id="customer-search" placeholder="ค้นหาชื่อหรือบริษัท..." class="w-full pl-10 pr-4 py-2 bg-white rounded-lg border border-slate-200 text-sm outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button onclick="toggleCustomerForm()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 mobile-w-full">
                                <i class="fas fa-plus"></i> เพิ่มลูกค้า
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="w-full text-left border-collapse min-w-[600px]">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">บริษัท / ผู้ติดต่อ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">ประเภท</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">การติดต่อ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">จัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="customer-list" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
                
                <div id="customer-form-container" class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden form-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex items-center gap-3 bg-slate-50/50">
                        <div class="bg-blue-100 p-2 rounded-lg text-blue-600"><i id="customer-form-icon" class="fas fa-user-plus text-xl"></i></div>
                        <div>
                            <h2 id="customer-form-title" class="text-lg lg:text-xl font-bold">เพิ่มลูกค้าใหม่</h2>
                            <p class="text-sm text-slate-500">กรอกข้อมูลผู้ติดต่อและบริษัทเพื่อเริ่มการเสนอราคา</p>
                        </div>
                    </div>
                    
                    <form id="add-customer-form" class="p-4 lg:p-8 space-y-4 lg:space-y-6">
                        <input type="hidden" id="customer-id" value="">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ชื่อองค์กร <span class="text-red-500">*</span></label>
                                <input type="text" id="customer-company" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="ชื่อบริษัท/หน่วยงาน" required>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ประเภทองค์กร</label>
                                <select id="customer-type" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100">
                                    <option value="เอกชน">เอกชน</option>
                                    <option value="ราชการ">ราชการ</option>
                                    <option value="รัฐวิสาหกิจ">รัฐวิสาหกิจ</option>
                                </select>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">หมวดหมู่ธุรกิจ</label>
                                <input type="text" id="customer-category" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="เช่น อาหาร, ก่อสร้าง">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700 flex items-center gap-2"><i class="fas fa-map-marker-alt text-blue-500"></i> ที่อยู่หน่วยงาน</label>
                            <textarea id="customer-address" class="w-full px-3 lg:px-4 py-2 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100 h-24 lg:h-20 resize-none" placeholder="บ้านเลขที่, ถนน, ตำบล, อำเภอ, จังหวัด..."></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ชื่อผู้ติดต่อ <span class="text-red-500">*</span></label>
                                <input type="text" id="customer-name" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="คุณ..." required>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">เบอร์โทรศัพท์ <span class="text-red-500">*</span></label>
                                <input type="tel" id="customer-phone" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="0xx-xxxxxxx" required>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">อีเมล</label>
                                <input type="email" id="customer-email" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="example@mail.com">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">หมายเหตุ</label>
                            <textarea id="customer-note" class="w-full px-3 lg:px-4 py-2 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100 h-20 resize-none" placeholder="หมายเหตุเพิ่มเติม..."></textarea>
                        </div>
                        <div class="flex flex-col lg:flex-row justify-end gap-3 pt-2">
                            <button type="button" id="cancel-edit-customer-btn" onclick="resetCustomerForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2.5 rounded-lg font-bold shadow-lg transition-all hidden mobile-w-full lg:w-auto">ยกเลิกการแก้ไข</button>
                            <button type="button" onclick="hideCustomerForm()" class="bg-gray-400 hover:bg-gray-500 text-white px-6 py-2.5 rounded-lg font-bold shadow-lg transition-all mobile-w-full lg:w-auto">ปิดฟอร์ม</button>
                            <button type="submit" id="submit-customer-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 lg:px-8 py-2.5 lg:py-3 rounded-lg lg:rounded-xl font-bold shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 mobile-w-full lg:w-auto">
                                <i class="fas fa-user-plus"></i> บันทึกข้อมูลลูกค้า
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- ========== PRODUCTS TAB ========== -->
        <div id="products-tab" class="tab-content animate-fadeIn hidden">
            <div class="space-y-6 lg:space-y-8">
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 bg-slate-50/50">
                        <div class="flex items-center gap-3">
                            <div class="bg-blue-100 p-2 rounded-lg text-blue-600"><i class="fas fa-box text-xl"></i></div>
                            <h2 class="text-lg lg:text-xl font-bold">Product Management</h2>
                        </div>
                        <div class="flex gap-2">
                            <div class="relative w-full md:w-64">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" id="product-search" placeholder="ค้นหาสินค้า..." class="w-full pl-10 pr-4 py-2 bg-white rounded-lg border border-slate-200 text-sm outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button onclick="toggleProductForm()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 mobile-w-full">
                                <i class="fas fa-plus"></i> เพิ่มสินค้า
                            </button>
                        </div>
                    </div>
                    
                    <div class="px-4 lg:px-6 py-3 bg-white border-b border-slate-200 flex flex-wrap gap-2">
                        <button onclick="filterProductCategory('all')" id="cat-all" class="product-category-tab px-4 py-2 text-sm font-bold rounded-lg bg-blue-600 text-white">ทั้งหมด</button>
                        <button onclick="filterProductCategory('onAir')" id="cat-onAir" class="product-category-tab px-4 py-2 text-sm font-bold rounded-lg bg-slate-100 text-slate-700 hover:bg-slate-200">On Air</button>
                        <button onclick="filterProductCategory('online')" id="cat-online" class="product-category-tab px-4 py-2 text-sm font-bold rounded-lg bg-slate-100 text-slate-700 hover:bg-slate-200">Online</button>
                        <button onclick="filterProductCategory('production')" id="cat-production" class="product-category-tab px-4 py-2 text-sm font-bold rounded-lg bg-slate-100 text-slate-700 hover:bg-slate-200">Production</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full text-left border-collapse min-w-[900px]">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider w-12 text-center">ลำดับ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">รหัสสินค้า</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">สินค้า</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">ประเภท</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">ราคา</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">ตัวอย่าง</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">จัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="product-list" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
                
                <div id="product-form-container" class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden form-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex items-center gap-3 bg-slate-50/50">
                        <div class="bg-blue-100 p-2 rounded-lg text-blue-600"><i id="product-form-icon" class="fas fa-plus text-xl"></i></div>
                        <div>
                            <h2 id="product-form-title" class="text-lg lg:text-xl font-bold">เพิ่มสินค้าใหม่</h2>
                            <p class="text-sm text-slate-500">เพิ่มสินค้าและบริการสำหรับการเสนอราคา</p>
                        </div>
                    </div>
                    
                    <form id="add-product-form" class="p-4 lg:p-8 space-y-4 lg:space-y-6">
                        <input type="hidden" id="product-id" value="">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ประเภทสินค้า <span class="text-red-500">*</span></label>
                                <select id="product-type" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" onchange="updateProductCode()">
                                    <option value="">-- เลือกประเภท --</option>
                                    <option value="onAir">On Air (ออกอากาศ)</option>
                                    <option value="online">Online (ออนไลน์)</option>
                                    <option value="production">Production (ผลิต)</option>
                                </select>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">รหัสสินค้า</label>
                                <input type="text" id="product-code" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" readonly>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ชื่อสินค้า <span class="text-red-500">*</span></label>
                                <input type="text" id="product-name" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="ชื่อสินค้าหรือบริการ" required>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ราคา (บาท) <span class="text-red-500">*</span></label>
                                <input type="number" id="product-price" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="0.00" min="0" step="0.01" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">โปรโมชัน</label>
                                <select id="product-promotion" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100">
                                    <option value="ไม่มี">ไม่มีโปรโมชัน</option>
                                    <option value="มี">มีโปรโมชัน</option>
                                </select>
                            </div>
                            <div id="promotion-detail-container" class="space-y-1.5 hidden">
                                <label class="text-sm font-semibold text-slate-700">รายละเอียดโปรโมชัน</label>
                                <input type="text" id="product-promotion-detail" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="เช่น ซื้อ 10 ครั้ง แถม 1 ครั้ง">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700 flex items-center gap-2"><i class="fas fa-link text-blue-500"></i> ลิงก์ตัวอย่างสินค้า</label>
                            <div class="flex gap-2">
                                <input type="url" id="product-sample-link" class="flex-1 px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="https://youtube.com/watch?v=... หรือ https://tiktok.com/...">
                                <div class="flex gap-1">
                                    <button type="button" onclick="insertSampleLink('youtube')" class="bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg"><i class="fab fa-youtube"></i></button>
                                    <button type="button" onclick="insertSampleLink('tiktok')" class="bg-black hover:bg-gray-800 text-white px-3 py-2 rounded-lg"><i class="fab fa-tiktok"></i></button>
                                    <button type="button" onclick="insertSampleLink('drive')" class="bg-blue-100 hover:bg-blue-200 text-blue-600 px-3 py-2 rounded-lg"><i class="fab fa-google-drive"></i></button>
                                </div>
                            </div>
                            <p class="text-xs text-slate-500 mt-1">วางลิงก์ YouTube, TikTok, Google Drive หรือเว็บตัวอย่าง</p>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">หมายเหตุเพิ่มเติม</label>
                            <textarea id="product-note" class="w-full px-3 lg:px-4 py-2 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100 h-24 lg:h-20 resize-none" placeholder="รายละเอียดเพิ่มเติมเกี่ยวกับสินค้า..."></textarea>
                        </div>
                        <div class="flex flex-col lg:flex-row justify-end gap-3 pt-2">
                            <button type="button" id="cancel-edit-btn" onclick="resetProductForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2.5 rounded-lg font-bold shadow-lg transition-all hidden mobile-w-full lg:w-auto">ยกเลิกการแก้ไข</button>
                            <button type="button" onclick="hideProductForm()" class="bg-gray-400 hover:bg-gray-500 text-white px-6 py-2.5 rounded-lg font-bold shadow-lg transition-all mobile-w-full lg:w-auto">ปิดฟอร์ม</button>
                            <button type="submit" id="submit-product-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 lg:px-8 py-2.5 lg:py-3 rounded-lg lg:rounded-xl font-bold shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 mobile-w-full lg:w-auto">
                                <i class="fas fa-plus"></i> เพิ่มสินค้า
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- ========== PACKAGES TAB ========== -->
        <div id="packages-tab" class="tab-content animate-fadeIn hidden">
            <div class="space-y-6 lg:space-y-8">
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 bg-slate-50/50">
                        <div class="flex items-center gap-3">
                            <div class="bg-blue-100 p-2 rounded-lg text-blue-600"><i class="fas fa-boxes text-xl"></i></div>
                            <h2 class="text-lg lg:text-xl font-bold">Package Management</h2>
                        </div>
                        <div class="flex gap-2">
                            <div class="relative w-full md:w-64">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" id="package-search" placeholder="ค้นหาแพ็กเกจ..." class="w-full pl-10 pr-4 py-2 bg-white rounded-lg border border-slate-200 text-sm outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button onclick="togglePackageForm()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 mobile-w-full">
                                <i class="fas fa-plus"></i> สร้างแพ็กเกจ
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full text-left border-collapse min-w-[900px]">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider w-12 text-center">ลำดับ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">รหัสแพ็กเกจ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">ชื่อแพ็กเกจ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">จำนวนสินค้า</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">ราคารวม</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">จัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="package-list" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
                
                <div id="package-detail-modal" class="modal">
                    <div class="modal-content w-full max-w-3xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-slate-900" id="modal-package-name">รายละเอียดแพ็กเกจ</h3>
                            <button onclick="closePackageModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times text-2xl"></i></button>
                        </div>
                        <div id="modal-package-detail" class="space-y-4"></div>
                    </div>
                </div>
                
                <div id="package-form-container" class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden form-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex items-center gap-3 bg-slate-50/50">
                        <div class="bg-blue-100 p-2 rounded-lg text-blue-600"><i id="package-form-icon" class="fas fa-plus text-xl"></i></div>
                        <div>
                            <h2 id="package-form-title" class="text-lg lg:text-xl font-bold">สร้างแพ็กเกจใหม่</h2>
                            <p class="text-sm text-slate-500">เลือกสินค้าหลายรายการเพื่อรวมเป็นแพ็กเกจ</p>
                        </div>
                    </div>
                    
                    <form id="add-package-form" class="p-4 lg:p-8 space-y-4 lg:space-y-6">
                        <input type="hidden" id="package-id" value="">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ชื่อแพ็กเกจ <span class="text-red-500">*</span></label>
                                <input type="text" id="package-name" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="ชื่อแพ็กเกจ" required>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">รหัสแพ็กเกจ</label>
                                <input type="text" id="package-code" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" readonly>
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">รายละเอียดแพ็กเกจ</label>
                            <textarea id="package-description" class="w-full px-3 lg:px-4 py-2 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100 h-20 resize-none" placeholder="อธิบายรายละเอียดแพ็กเกจ..."></textarea>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-semibold text-slate-700">เลือกสินค้าตามหมวดหมู่</label>
                                <span id="selected-products-count" class="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">เลือกแล้ว: 0 รายการ</span>
                            </div>
                            <div class="flex flex-wrap gap-2 mb-3">
                                <button type="button" onclick="filterPackageCategory('all')" id="package-cat-all" class="package-cat-btn px-4 py-2 text-sm font-bold rounded-lg bg-blue-600 text-white">ทั้งหมด</button>
                                <button type="button" onclick="filterPackageCategory('onAir')" id="package-cat-onAir" class="package-cat-btn px-4 py-2 text-sm font-bold rounded-lg bg-slate-100 text-slate-700">On Air</button>
                                <button type="button" onclick="filterPackageCategory('online')" id="package-cat-online" class="package-cat-btn px-4 py-2 text-sm font-bold rounded-lg bg-slate-100 text-slate-700">Online</button>
                                <button type="button" onclick="filterPackageCategory('production')" id="package-cat-production" class="package-cat-btn px-4 py-2 text-sm font-bold rounded-lg bg-slate-100 text-slate-700">Production</button>
                            </div>
                            <div class="bg-slate-50 rounded-lg lg:rounded-xl p-4 max-h-96 overflow-y-auto">
                                <div id="package-products-container" class="space-y-2"></div>
                            </div>
                        </div>
                        <div id="selected-products-summary" class="hidden">
                            <div class="bg-emerald-50 border border-emerald-200 rounded-lg lg:rounded-xl p-4">
                                <h4 class="text-sm font-bold text-emerald-800 mb-2">สินค้าในแพ็กเกจ</h4>
                                <div id="selected-products-list" class="space-y-1 max-h-40 overflow-y-auto"></div>
                                <div class="mt-3 pt-3 border-t border-emerald-200">
                                    <div class="flex justify-between text-sm font-bold">
                                        <span>ราคารวม:</span>
                                        <span id="package-total-price" class="text-emerald-700">0 ฿</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ราคาแพ็กเกจ (บาท) <span class="text-red-500">*</span></label>
                                <input type="number" id="package-price" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="0.00" min="0" step="0.01" required>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ส่วนลดแพ็กเกจ (%)</label>
                                <input type="number" id="package-discount" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100" placeholder="0" min="0" max="100" step="1" value="0">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">หมายเหตุ</label>
                            <textarea id="package-note" class="w-full px-3 lg:px-4 py-2 rounded-lg lg:rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-slate-100 h-20 resize-none" placeholder="หมายเหตุเพิ่มเติมเกี่ยวกับแพ็กเกจ..."></textarea>
                        </div>
                        <div class="flex flex-col lg:flex-row justify-end gap-3 pt-2">
                            <button type="button" id="cancel-edit-package-btn" onclick="resetPackageForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2.5 rounded-lg font-bold shadow-lg transition-all hidden mobile-w-full lg:w-auto">ยกเลิกการแก้ไข</button>
                            <button type="button" onclick="hidePackageForm()" class="bg-gray-400 hover:bg-gray-500 text-white px-6 py-2.5 rounded-lg font-bold shadow-lg transition-all mobile-w-full lg:w-auto">ปิดฟอร์ม</button>
                            <button type="submit" id="submit-package-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 lg:px-8 py-2.5 lg:py-3 rounded-lg lg:rounded-xl font-bold shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 mobile-w-full lg:w-auto">
                                <i class="fas fa-plus"></i> สร้างแพ็กเกจ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- ========== ORDERS TAB ========== -->
        <div id="orders-tab" class="tab-content animate-fadeIn hidden">
            <div class="space-y-6 lg:space-y-8">
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex items-center gap-3 bg-slate-50">
                        <i class="fas fa-plus text-blue-600 text-xl"></i>
                        <h2 class="text-lg lg:text-xl font-bold">Order Management</h2>
                    </div>
                    <div class="p-4 lg:p-8 space-y-6 lg:space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6 items-end">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">เลือกลูกค้า</label>
                                <select id="order-customer" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100 transition-all">
                                    <option value="">-- เลือกลูกค้า --</option>
                                </select>
                            </div>
                            <div id="customer-type-display" class="space-y-1.5 hidden">
                                <div class="flex items-center gap-2 p-3 bg-blue-50 rounded-lg lg:rounded-xl border border-blue-100">
                                    <i class="fas fa-building text-blue-500"></i>
                                    <div>
                                        <p class="text-[10px] text-blue-400 uppercase font-black tracking-widest">ประเภทองค์กรอัตโนมัติ</p>
                                        <p id="selected-customer-type" class="text-sm font-bold text-blue-900"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">ประเภทรายการ</label>
                                <div class="grid grid-cols-3 gap-2 p-1 bg-slate-100 rounded-lg lg:rounded-xl">
                                    <button type="button" onclick="setOrderType('Produce')" id="order-type-produce" class="order-type-btn py-2 text-xs font-bold rounded-lg transition-all active">Produce</button>
                                    <button type="button" onclick="setOrderType('Package')" id="order-type-package" class="order-type-btn py-2 text-xs font-bold rounded-lg transition-all">Package</button>
                                    <button type="button" onclick="setOrderType('Production')" id="order-type-production" class="order-type-btn py-2 text-xs font-bold rounded-lg transition-all">Production</button>
                                </div>
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-sm font-semibold text-slate-700">สินค้า / บริการ</label>
                                <select id="order-product" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100 transition-all">
                                    <option value="">-- เลือกรายการ --</option>
                                </select>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-2">
                                <label class="text-sm font-semibold text-slate-700 flex items-center gap-2"><i class="fas fa-clock text-blue-500"></i> ช่วงเวลาออกอากาศ</label>
                                <span id="selected-slots-count" class="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">เลือกแล้ว: 0 ครั้ง/วัน</span>
                            </div>
                            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2" id="time-slots-container"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6 pt-4 border-t border-slate-100">
                            <div class="space-y-4">
                                <label class="text-sm font-semibold text-slate-700 flex items-center gap-2"><i class="fas fa-calendar text-blue-500"></i> ระยะเวลาออกอากาศ</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="space-y-1">
                                        <span class="text-[10px] text-slate-400 uppercase font-bold">วันเริ่ม</span>
                                        <input type="date" id="order-start-date" class="w-full px-3 py-2 rounded-lg lg:rounded-xl border border-slate-200 text-sm outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                                    </div>
                                    <div class="space-y-1">
                                        <span class="text-[10px] text-slate-400 uppercase font-bold">วันสิ้นสุด</span>
                                        <input type="date" id="order-end-date" class="w-full px-3 py-2 rounded-lg lg:rounded-xl border border-slate-200 text-sm outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="space-y-1.5">
                                    <label class="text-sm font-semibold text-slate-700">วันออกอากาศในสัปดาห์</label>
                                    <div class="flex flex-wrap gap-2" id="weekdays-container"></div>
                                </div>
                                <div class="space-y-1.5">
                                    <label class="text-sm font-semibold text-slate-700">การชำระเงิน</label>
                                    <select id="order-payment-type" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100 transition-all">
                                        <option value="หลังออกอากาศ">ชำระหลังออกอากาศ</option>
                                        <option value="ก่อนออกอากาศ">ชำระก่อนออกอากาศ (ลดเพิ่ม 5%)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">หมายเหตุ/ข้อความแถม</label>
                            <textarea id="order-note" class="w-full px-3 lg:px-4 py-2 lg:py-3 rounded-lg lg:rounded-xl border border-slate-200 text-sm outline-none focus:ring-2 focus:ring-blue-500 resize-none bg-slate-100" placeholder="ระบุข้อความแถม..." rows="2"></textarea>
                        </div>
                        <div class="flex justify-end">
                            <button onclick="addOrderToCampaign()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold shadow-lg transition-all flex items-center gap-2 mobile-w-full justify-center">
                                <i class="fas fa-plus"></i> เพิ่มรายการสั่งซื้อ
                            </button>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden lg:sticky lg:top-8">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex items-center gap-3 bg-slate-50">
                        <i class="fas fa-calculator text-emerald-600 text-xl"></i>
                        <h2 class="text-lg lg:text-xl font-bold">สรุปการคำนวณ</h2>
                    </div>
                    <div class="p-4 lg:p-6 space-y-4" id="calculation-summary">
                        <div class="py-8 lg:py-12 flex flex-col items-center justify-center text-slate-300 gap-3 text-center">
                            <i class="fas fa-calculator text-3xl lg:text-4xl opacity-20"></i>
                            <p class="text-xs">ระบุข้อมูลลูกค้า วันออกอากาศ<br/>และเลือกสินค้าเพื่อคำนวณราคา</p>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-900 rounded-xl lg:rounded-2xl p-4 lg:p-6 text-white shadow-xl border-l-4 border-yellow-500">
                    <h3 class="text-xs font-bold opacity-70 uppercase tracking-widest mb-4">ยอดรวมแคมเปญปัจจุบัน</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm"><span>ราคารวมทั้งหมด:</span><span id="campaign-total" class="font-mono">0 ฿</span></div>
                        <div class="flex justify-between text-sm text-emerald-400"><span>ส่วนลดรวมสะสม:</span><span id="campaign-discount" class="font-mono">0 ฿</span></div>
                        <div class="pt-3 border-t border-white/10 flex justify-between items-center">
                            <span class="font-bold text-base lg:text-lg">สุทธิทั้งสิ้น:</span>
                            <span id="campaign-net" class="text-xl lg:text-2xl font-black">0 ฿</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex flex-col lg:flex-row lg:items-center justify-between gap-4 bg-slate-50">
                        <h2 class="text-lg lg:text-xl font-bold">รายการสั่งซื้อในแคมเปญ (<span id="orders-count">0</span>)</h2>
                    </div>
                    <div class="table-container">
                        <table class="w-full text-left border-collapse min-w-[1000px]">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-[10px] font-bold text-slate-500 uppercase">สินค้า / บริการ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-[10px] font-bold text-slate-500 uppercase text-center">จำนวนวัน</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-[10px] font-bold text-slate-500 uppercase text-center">ความถี่</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-[10px] font-bold text-slate-500 uppercase text-right">ส่วนลด</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-[10px] font-bold text-slate-500 uppercase text-right font-black">ยอดสุทธิ</th>
                                    <th class="px-4 lg:px-6 py-3 lg:py-4 text-[10px] font-bold text-slate-500 uppercase text-center">จัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ========== QUOTATIONS TAB ========== -->
        <div id="quotations-tab" class="tab-content animate-fadeIn hidden">
            <div class="space-y-6 lg:space-y-8">
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden no-print">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex flex-col lg:flex-row lg:items-center justify-between gap-4 bg-slate-50">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-file-invoice-dollar text-blue-600 text-xl"></i>
                            <h2 class="text-lg lg:text-xl font-bold">Quotation Management</h2>
                        </div>
                        <button onclick="printQuotation()" id="print-quotation-btn" class="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 lg:px-6 py-2 lg:py-2.5 rounded-lg lg:rounded-xl text-sm font-bold shadow-lg transition-all active:scale-95 mobile-w-full lg:w-auto">
                            <i class="fas fa-print"></i> พิมพ์ใบเสนอราคา
                        </button>
                    </div>
                    <div class="p-4 lg:p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">เลือกลูกค้า</label>
                            <select id="quotation-customer" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                                <option value="">-- เลือกลูกค้า --</option>
                            </select>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">ชื่อผู้เสนอราคา</label>
                            <input type="text" id="staff-name" value="ฝ่ายขาย" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">เบอร์ติดต่อผู้ขาย</label>
                            <input type="text" id="staff-phone" value="055-287833" class="w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg lg:rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                        </div>
                    </div>
                </div>
                
                <div id="quotation-preview" class="bg-white p-4 lg:p-6 xl:p-8 shadow-2xl rounded-sm border border-slate-200 max-w-5xl mx-auto text-slate-800 min-h-[1100px] flex flex-col font-['Sarabun'] hidden">
                    <div class="quotation-header text-center mb-6">
                        <h1 class="text-xl lg:text-2xl font-black text-blue-900 mb-1">ใบเสนอราคา</h1>
                        <p class="text-base lg:text-lg font-bold">MCOT Radio Network Phitsanulok</p>
                        <p class="text-sm">สถานีวิทยุกระจายเสียง อสมท จังหวัดพิษณุโลก F.M. 106.25 MHz.</p>
                        <div class="quotation-line my-2"></div>
                        <p class="text-sm">บมจ.อสมท สาขาพิษณุโลก 1 สาขาที่ 00010</p>
                        <p class="text-sm">361/4 หมู่ที่ 2 ถนนบึงพระ-วัดหล่ม ต.บึงพระ อ.เมือง จ.พิษณุโลก 65000</p>
                        <p class="text-sm font-bold mt-1">โทร. 055-287833 | เลขประจำตัวผู้เสียภาษี 0107547000745</p>
                        <div class="quotation-line my-2"></div>
                    </div>
                    <div class="quotation-section mb-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4 text-sm">
                            <div class="space-y-2">
                                <div class="flex items-start"><span class="font-bold w-20">เรียน:</span><span id="quotation-company" class="font-black border-b border-dotted border-slate-400 flex-1 min-h-[1.5em]"></span></div>
                                <div class="flex items-start"><span class="font-bold w-20">ที่อยู่:</span><span id="quotation-address" class="border-b border-dotted border-slate-400 flex-1 min-h-[1.5em]"></span></div>
                                <div class="flex items-start"><span class="font-bold w-20">เบอร์โทร.:</span><span id="quotation-phone" class="border-b border-dotted border-slate-400 flex-1 min-h-[1.5em]"></span></div>
                            </div>
                            <div class="space-y-2 flex flex-col items-end">
                                <div class="flex w-full justify-end">
                                    <span class="font-bold mr-2">วันที่:</span>
                                    <span class="font-bold border-b border-dotted border-slate-400 w-40 text-center">
                                        <span id="quotation-date"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 overflow-hidden mb-6">
                        <div class="overflow-x-auto">
                            <table class="w-full text-xs border-collapse min-w-[600px]">
                                <thead>
                                    <tr class="bg-slate-200 border-y-2 border-slate-800">
                                        <th class="p-2 lg:p-3 text-left border-x border-slate-300">รายละเอียด</th>
                                        <th class="p-2 lg:p-3 text-center border-x border-slate-300 w-16 lg:w-24">จำนวนวัน</th>
                                        <th class="p-2 lg:p-3 text-center border-x border-slate-300 w-16 lg:w-20">ครั้ง/วัน</th>
                                        <th class="p-2 lg:p-3 text-right border-x border-slate-300 w-20 lg:w-28">ครั้งรวม</th>
                                        <th class="p-2 lg:p-3 text-right border-x border-slate-300 w-24 lg:w-32">ยอดสุทธิ (บาท)</th>
                                    </tr>
                                </thead>
                                <tbody id="quotation-items"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="mt-6 lg:mt-8 flex justify-end">
                        <div class="w-full lg:w-80 space-y-1">
                            <div class="flex justify-between text-sm py-1 border-b border-slate-100"><span class="font-bold">ยอดก่อน VAT รวม:</span><span id="quotation-before-vat" class="font-black">0 บาท</span></div>
                            <div class="flex justify-between text-sm py-1 border-b border-slate-100"><span class="font-bold">VAT 7% รวม:</span><span id="quotation-vat" class="font-black">0 บาท</span></div>
                            <div class="flex justify-between items-center bg-slate-800 text-white p-3 rounded-lg mt-2 shadow-md">
                                <span class="text-sm font-black">ยอดสุทธิรวม:</span>
                                <span id="quotation-total" class="text-lg lg:text-xl font-black">0 บาท</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 lg:mt-12 pt-6 lg:pt-8 border-t border-slate-300 text-xs">
                        <h3 class="font-bold text-slate-800 mb-3 text-sm">เงื่อนไขและรายละเอียดการชำระเงิน</h3>
                        <div class="space-y-2">
                            <p><strong>เงื่อนไข:</strong></p>
                            <ul class="list-disc pl-5 ml-3 space-y-1">
                                <li>ลูกค้ารายใหม่ชำระเงินก่อนออกอากาศ ในเวลาทำการ เวลา 09.00 น. – 15.00 น. (วันจันทร์ – วันศุกร์)</li>
                                <li>กรณีชำระหลัง เวลา 15.00 น. ถือว่าชำระในวันรุ่งขึ้น</li>
                            </ul>
                            <p><strong>รายละเอียดการชำระเงิน:</strong></p>
                            <ul class="list-disc pl-5 ml-3 space-y-1">
                                <li><strong>ชำระเป็นเช็ค:</strong> สั่งจ่ายในนาม บมจ.อสมท</li>
                                <li><strong>โอนเงินเข้าบัญชี:</strong> บมจ. อสมท บัญชีเลขที่ 015-1-05842-3 ธนาคารกรุงไทย สาขาสิงห์คอมเพล็กซ์</li>
                                <li><strong>ชำระเป็นเงินสด:</strong> ที่ฝ่ายการเงิน บมจ. อสมท สาขาพิษณุโลก 1 ในเวลาทำการ เวลา 09.00 น. – 15.00 น. (วันจันทร์ – วันศุกร์)</li>
                                <li><strong>หนังสือรับรองการหักภาษี ณ ที่จ่าย ออกในนาม:</strong> บมจ.อสมท 63/1 ถ.พระราม 9 แขวงห้วยขวาง เขตห้วยขวาง กรุงเทพฯ 10310 เลขประจำตัวผู้เสียภาษี 0107547000745</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 lg:mt-12 mb-8 lg:mb-12 flex justify-end">
                        <div class="text-center w-56 lg:w-64 space-y-8 lg:space-y-12">
                            <div class="border-b border-slate-300 pb-1"><p class="text-sm font-bold text-slate-800">ผู้เสนอราคา: <span id="quotation-staff-name">ฝ่ายขาย</span></p></div>
                            <div class="space-y-1">
                                <p class="text-xs">(....................................................................)</p>
                                <p class="text-xs font-bold text-slate-500">MCOT Radio Network Phitsanulok</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="quotation-empty" class="bg-white rounded-xl lg:rounded-2xl p-12 lg:p-24 text-center text-slate-400 border border-slate-200 shadow-sm flex flex-col items-center gap-4">
                    <i class="fas fa-file-invoice-dollar text-4xl lg:text-6xl opacity-10"></i>
                    <p class="text-base lg:text-lg font-medium">กรุณาเลือกลูกค้าเพื่อแสดงตัวอย่างใบเสนอราคา</p>
                    <p class="text-sm">ใบเสนอราคาจะถูกสร้างขึ้นอัตโนมัติตามรายการที่เลือก</p>
                </div>
            </div>
        </div>
        
        <!-- ========== REPORT TAB ========== -->
        <div id="report-tab" class="tab-content animate-fadeIn hidden">
            <div class="space-y-6 lg:space-y-8">
                <div class="bg-white rounded-xl lg:rounded-2xl shadow-sm border border-slate-200 overflow-hidden no-print">
                    <div class="p-4 lg:p-6 border-b border-slate-100 flex flex-col lg:flex-row lg:items-center justify-between gap-4 bg-slate-50">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-chart-bar text-blue-600 text-xl"></i>
                            <h2 class="text-lg lg:text-xl font-bold">Report Management</h2>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="printReport('customer')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 mobile-w-full justify-center"><i class="fas fa-print"></i> พิมพ์รายงานลูกค้า</button>
                            <button onclick="printReport('product')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 mobile-w-full justify-center"><i class="fas fa-print"></i> พิมพ์รายงานสินค้า</button>
                            <button onclick="printReport('package')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 mobile-w-full justify-center"><i class="fas fa-print"></i> พิมพ์รายงานแพ็กเกจ</button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                <div class="flex items-center justify-between">
                                    <div><p class="text-sm text-blue-600 font-bold">ลูกค้าทั้งหมด</p><p class="text-3xl font-black text-blue-800" id="report-customer-count">0</p></div>
                                    <i class="fas fa-users text-4xl text-blue-300"></i>
                                </div>
                                <button onclick="printReport('customer')" class="mt-3 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-bold">พิมพ์รายงาน</button>
                            </div>
                            <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100">
                                <div class="flex items-center justify-between">
                                    <div><p class="text-sm text-emerald-600 font-bold">สินค้าทั้งหมด</p><p class="text-3xl font-black text-emerald-800" id="report-product-count">0</p></div>
                                    <i class="fas fa-box text-4xl text-emerald-300"></i>
                                </div>
                                <button onclick="printReport('product')" class="mt-3 w-full bg-emerald-600 hover:bg-emerald-700 text-white py-2 rounded-lg text-sm font-bold">พิมพ์รายงาน</button>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                                <div class="flex items-center justify-between">
                                    <div><p class="text-sm text-purple-600 font-bold">แพ็กเกจทั้งหมด</p><p class="text-3xl font-black text-purple-800" id="report-package-count">0</p></div>
                                    <i class="fas fa-boxes text-4xl text-purple-300"></i>
                                </div>
                                <button onclick="printReport('package')" class="mt-3 w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg text-sm font-bold">พิมพ์รายงาน</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Print Report Container (Hidden) -->
        <div id="print-report-container" class="report-container print-report"></div>
    </main>

    <script>
        // ========== DATA STORAGE ==========
        let systemData = {
            customers: [],
            products: [],
            packages: [],
            orders: [],
            settings: {
                lastSave: null,
                version: "4.0",
                sidebarExpanded: false
            }
        };
        
        // ========== CONSTANTS ==========
        const TIME_SLOTS = [
            { period: 'ช่วงเช้า (08:00-10:00)', slots: ['08:00-08:30', '08:30-09:00', '09:00-09:30', '09:30-10:00'] },
            { period: 'ช่วงสาย (10:00-12:00)', slots: ['10:00-10:30', '10:30-11:00', '11:00-11:30', '11:30-12:00'] },
            { period: 'ช่วงเที่ยง (12:00-14:00)', slots: ['12:00-12:30', '12:30-13:00', '13:00-13:30', '13:30-14:00'] },
            { period: 'ช่วงบ่าย (14:00-16:00)', slots: ['14:00-14:30', '14:30-15:00', '15:00-15:30', '15:30-16:00'] },
            { period: 'ช่วงเย็น (16:00-18:00)', slots: ['16:00-16:30', '16:30-17:00', '17:00-17:30', '17:30-18:00'] }
        ];
        
        const WEEKDAYS = [
            { label: 'อา', value: 0 },
            { label: 'จ', value: 1 },
            { label: 'อ', value: 2 },
            { label: 'พ', value: 3 },
            { label: 'พฤ', value: 4 },
            { label: 'ศ', value: 5 },
            { label: 'ส', value: 6 }
        ];
        
        // ========== PRODUCT CODE GENERATOR ==========
        const productTypeCodes = {
            'onAir': { prefix: 'OA', nextNumber: 1 },
            'online': { prefix: 'OL', nextNumber: 1 },
            'production': { prefix: 'Pr', nextNumber: 1 }
        };
        
        let packageCounter = 1;
        
        // ========== ORDER SECTION STATE ==========
        let currentOrder = {
            selectedCustomerId: '',
            orderType: 'Produce',
            selectedItemId: '',
            startDate: new Date().toISOString().split('T')[0],
            endDate: '',
            selectedDays: [1, 2, 3, 4, 5],
            selectedSlots: [],
            paymentType: 'หลังออกอากาศ',
            note: ''
        };
        
        // ========== AUTO SAVE ==========
        const AUTO_SAVE_INTERVAL = 15 * 60 * 1000;
        let autoSaveTimer = null;
        
        // ========== STATE ==========
        let selectedPackageProducts = [];
        let currentPackageCategory = 'all';
        let currentProductCategory = 'all';
        let isSidebarExpanded = false;
        
        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const saved = localStorage.getItem('mcot_package_v4_data');
                if (saved) {
                    systemData = JSON.parse(saved);
                    if (!systemData.settings) systemData.settings = { lastSave: null, version: "4.0", sidebarExpanded: false };
                    if (systemData.settings.sidebarExpanded === undefined) systemData.settings.sidebarExpanded = false;
                } else {
                    addSampleData();
                }
            } catch (e) {
                console.error("Error loading data:", e);
                addSampleData();
            }
            
            setTimeout(() => {
                updateLastSaved();
                updateProductCodeNumbers();
                updatePackageCounter();
                loadSidebarState();
                setupEventListeners();
                switchTab('customers');
                updateBadges();
                setupAutoSave();
                initializeOrdersTab();
                renderAll();
            }, 100);
        });
        
        // ========== SIDEBAR ==========
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            if (!sidebar || !mainContent) return;
            if (isSidebarExpanded) {
                sidebar.classList.remove('expanded');
                mainContent.classList.remove('expanded');
                isSidebarExpanded = false;
                systemData.settings.sidebarExpanded = false;
            } else {
                sidebar.classList.add('expanded');
                mainContent.classList.add('expanded');
                isSidebarExpanded = true;
                systemData.settings.sidebarExpanded = true;
            }
            saveData();
        }
        
        function loadSidebarState() {
            if (systemData.settings?.sidebarExpanded) {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('main-content');
                if (sidebar && mainContent) {
                    sidebar.classList.add('expanded');
                    mainContent.classList.add('expanded');
                    isSidebarExpanded = true;
                }
            }
        }
        
        // ========== MOBILE MENU ==========
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-menu-overlay');
            if (!sidebar || !overlay) return;
            
            if (sidebar.classList.contains('expanded')) {
                sidebar.classList.remove('expanded');
                overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            } else {
                sidebar.classList.add('expanded');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-menu-overlay');
            if (!sidebar || !overlay) return;
            
            sidebar.classList.remove('expanded');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // ========== TAB ==========
        function switchTab(tabName) {
            closeMobileMenu();
            document.querySelectorAll('.tab-content').forEach(tab => tab?.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(btn => btn?.classList.remove('active'));
            
            const tabElement = document.getElementById(`${tabName}-tab`);
            if (tabElement) tabElement.classList.remove('hidden');
            
            const activeBtn = document.querySelector(`.menu-item[data-tab="${tabName}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            const titleElement = document.getElementById('page-title');
            if (titleElement) titleElement.textContent = getTabTitle(tabName);
            
            if (tabName === 'customers') { renderCustomers(); resetCustomerForm(); }
            if (tabName === 'products') { setTimeout(() => { renderProducts(); resetProductForm(); }, 100); }
            if (tabName === 'packages') { setTimeout(() => { renderPackages(); renderPackageProducts(); resetPackageForm(); }, 100); }
            if (tabName === 'orders') { setTimeout(() => { initializeOrdersTab(); }, 100); }
            if (tabName === 'quotations') { renderQuotations(); }
            if (tabName === 'report') { renderReport(); }
        }
        
        function getTabTitle(tabName) {
            const titles = {
                'customers': 'Customer Management',
                'products': 'Product Management',
                'packages': 'Package Management',
                'orders': 'Order Management',
                'quotations': 'Quotation Management',
                'report': 'Report Management'
            };
            return titles[tabName] || 'ระบบจัดการแพ็กเกจ';
        }
        
        // ========== AUTO SAVE ==========
        function setupAutoSave() {
            if (autoSaveTimer) clearInterval(autoSaveTimer);
            autoSaveTimer = setInterval(() => {
                if (systemData.customers.length > 0 || systemData.products.length > 0 || 
                    systemData.orders.length > 0 || systemData.packages.length > 0) {
                    saveData();
                }
            }, AUTO_SAVE_INTERVAL);
        }
        
        // ========== DATA MANAGEMENT ==========
        function saveData() {
            systemData.settings.lastSave = new Date().toISOString();
            localStorage.setItem('mcot_package_v4_data', JSON.stringify(systemData));
            updateLastSaved();
            updateBadges();
            showNotification('บันทึกข้อมูลเรียบร้อยแล้ว', 'success');
        }
        
        function exportData() {
            try {
                const dataStr = JSON.stringify(systemData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hour = String(now.getHours()).padStart(2, '0');
                const minute = String(now.getMinutes()).padStart(2, '0');
                
                link.download = `MCOT_Data_${year}${month}${day}_${hour}${minute}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                
                showNotification('ส่งออกข้อมูลสำเร็จ', 'success');
            } catch (error) {
                console.error('Export error:', error);
                showNotification('เกิดข้อผิดพลาดในการส่งออกข้อมูล', 'error');
            }
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.toLowerCase().endsWith('.json')) {
                showNotification('กรุณาเลือกไฟล์ .json เท่านั้น', 'error');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData || typeof importedData !== 'object') {
                        showNotification('ไฟล์ข้อมูลไม่ถูกต้อง', 'error');
                        event.target.value = '';
                        return;
                    }
                    
                    if (confirm("คุณแน่ใจหรือไม่ว่าต้องการนำเข้าข้อมูล?\n\nข้อมูลปัจจุบันจะถูกเขียนทับทั้งหมด")) {
                        systemData = importedData;
                        
                        if (!systemData.customers) systemData.customers = [];
                        if (!systemData.products) systemData.products = [];
                        if (!systemData.packages) systemData.packages = [];
                        if (!systemData.orders) systemData.orders = [];
                        if (!systemData.settings) {
                            systemData.settings = { 
                                lastSave: new Date().toISOString(), 
                                version: "4.0", 
                                sidebarExpanded: false 
                            };
                        }
                        
                        updateProductCodeNumbers();
                        updatePackageCounter();
                        
                        if (systemData.settings.sidebarExpanded) {
                            const sidebar = document.getElementById('sidebar');
                            const mainContent = document.getElementById('main-content');
                            if (sidebar && mainContent) {
                                sidebar.classList.add('expanded');
                                mainContent.classList.add('expanded');
                                isSidebarExpanded = true;
                            }
                        }
                        
                        saveData();
                        
                        const activeTab = document.querySelector('.menu-item.active')?.getAttribute('data-tab') || 'customers';
                        switchTab(activeTab);
                        
                        updateBadges();
                        showNotification('นำเข้าข้อมูลสำเร็จ', 'success');
                    }
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    showNotification('ไม่สามารถอ่านไฟล์ JSON ได้', 'error');
                }
                event.target.value = '';
            };
            reader.readAsText(file);
        }
        
        function clearData() {
            if (confirm("⚠️ ล้างข้อมูลทั้งหมด\n\nการกระทำนี้ไม่สามารถย้อนกลับได้\nคุณต้องการล้างข้อมูลทั้งหมดหรือไม่?")) {
                localStorage.removeItem('mcot_package_v4_data');
                
                systemData = {
                    customers: [],
                    products: [],
                    packages: [],
                    orders: [],
                    settings: {
                        lastSave: null,
                        version: "4.0",
                        sidebarExpanded: false
                    }
                };
                
                productTypeCodes.onAir.nextNumber = 1;
                productTypeCodes.online.nextNumber = 1;
                productTypeCodes.production.nextNumber = 1;
                packageCounter = 1;
                
                selectedPackageProducts = [];
                
                renderAll();
                
                hideCustomerForm();
                hideProductForm();
                hidePackageForm();
                closePackageModal();
                
                showNotification('ล้างข้อมูลเรียบร้อยแล้ว', 'success');
            }
        }
        
        function addSampleData() {
            systemData.customers = [
                { id: 'CUST-1', company: 'บริษัท เอเบซี จำกัด', type: 'เอกชน', category: 'อาหาร', address: '123 ถนนสุขุมวิท กรุงเทพฯ', name: 'คุณสมชาย ใจดี', phone: '081-2345678', email: 'somchai@abc.com', note: 'ลูกค้าประจำ', created: new Date().toISOString() },
                { id: 'CUST-2', company: 'โรงพยาบาลศิริราช', type: 'ราชการ', category: 'สาธารณสุข', address: '2 ถนนวังหลัง กรุงเทพฯ', name: 'นายแพทย์วิรัช เก่งมาก', phone: '02-1234567', email: 'doctor@siriraj.com', note: 'ลูกค้าราชการ', created: new Date().toISOString() },
                { id: 'CUST-3', company: 'การไฟฟ้าส่วนภูมิภาค', type: 'รัฐวิสาหกิจ', category: 'พลังงาน', address: '2000 ถนนเพชรบุรี กรุงเทพฯ', name: 'คุณสมศรี สวยงาม', phone: '082-9876543', email: 'somsri@pea.com', note: 'ลูกค้ารัฐวิสาหกิจ', created: new Date().toISOString() }
            ];
            updateProductCodeNumbers();
            systemData.products = [
                { id: 'PROD-1', code: 'OA-001', type: 'onAir', name: 'โฆษณาเสียง 30 วินาที', price: 1500, promotion: 'ไม่มี', sampleLink: 'https://youtube.com/watch?v=example1', note: 'ออกอากาศช่วงเวลาใดก็ได้', created: new Date().toISOString() },
                { id: 'PROD-2', code: 'OA-002', type: 'onAir', name: 'โฆษณาเสียง 60 วินาที', price: 2500, promotion: 'มี', promotionDetail: 'ซื้อ 10 ครั้ง แถม 1 ครั้ง', sampleLink: 'https://youtube.com/watch?v=example2', note: 'ออกอากาศช่วงเวลาใดก็ได้', created: new Date().toISOString() },
                { id: 'PROD-3', code: 'OL-001', type: 'online', name: 'โพสต์ Facebook', price: 5000, promotion: 'ไม่มี', sampleLink: 'https://tiktok.com/@example/video/123', note: 'พร้อมออกแบบกราฟิก', created: new Date().toISOString() },
                { id: 'PROD-4', code: 'Pr-001', type: 'production', name: 'ผลิตสปอตโฆษณา', price: 15000, promotion: 'ไม่มี', note: 'รวมเสียงพากย์และตัดต่อ', created: new Date().toISOString() }
            ];
            systemData.packages = [];
            systemData.orders = [];
            updatePackageCounter();
            saveData();
        }
        
        // ========== PRODUCT CODE ==========
        function updateProductCodeNumbers() {
            productTypeCodes.onAir.nextNumber = 1;
            productTypeCodes.online.nextNumber = 1;
            productTypeCodes.production.nextNumber = 1;
            systemData.products.forEach(product => {
                if (product.code) {
                    const prefix = product.code.split('-')[0];
                    const number = parseInt(product.code.split('-')[1]);
                    if (prefix === 'OA' && number >= productTypeCodes.onAir.nextNumber) productTypeCodes.onAir.nextNumber = number + 1;
                    else if (prefix === 'OL' && number >= productTypeCodes.online.nextNumber) productTypeCodes.online.nextNumber = number + 1;
                    else if (prefix === 'Pr' && number >= productTypeCodes.production.nextNumber) productTypeCodes.production.nextNumber = number + 1;
                }
            });
        }
        
        function updatePackageCounter() {
            if (systemData.packages && systemData.packages.length > 0) {
                let maxNumber = 0;
                systemData.packages.forEach(pkg => {
                    if (pkg.code) {
                        const match = pkg.code.match(/^PKG-(\d+)$/);
                        if (match) {
                            const number = parseInt(match[1]);
                            if (number > maxNumber) maxNumber = number;
                        }
                    }
                });
                packageCounter = maxNumber + 1;
            } else {
                packageCounter = 1;
            }
        }
        
        function generateProductCode(type) {
            if (!type || !productTypeCodes[type]) return '';
            const codeInfo = productTypeCodes[type];
            const codeNumber = codeInfo.nextNumber.toString().padStart(3, '0');
            const code = `${codeInfo.prefix}-${codeNumber}`;
            productTypeCodes[type].nextNumber++;
            return code;
        }
        
        function generatePackageCode() {
            const codeNumber = packageCounter.toString().padStart(3, '0');
            const code = `PKG-${codeNumber}`;
            packageCounter++;
            return code;
        }
        
        // ========== CUSTOMER ==========
        function toggleCustomerForm() {
            const form = document.getElementById('customer-form-container');
            if (form) {
                form.classList.toggle('form-hidden');
                if (!form.classList.contains('form-hidden')) { resetCustomerForm(); form.scrollIntoView({ behavior: 'smooth' }); }
            }
        }
        
        function hideCustomerForm() { 
            const form = document.getElementById('customer-form-container');
            if (form) { form.classList.add('form-hidden'); resetCustomerForm(); }
        }
        
        function addCustomer(event) {
            if (event) event.preventDefault();
            const company = document.getElementById('customer-company').value;
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const customerId = document.getElementById('customer-id').value;
            if (!company || !name || !phone) {
                showNotification('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'error');
                return;
            }
            const customerData = {
                id: customerId || `CUST-${Date.now()}`,
                company: company,
                type: document.getElementById('customer-type').value,
                category: document.getElementById('customer-category').value,
                address: document.getElementById('customer-address').value,
                name: name,
                phone: phone,
                email: document.getElementById('customer-email').value,
                note: document.getElementById('customer-note').value,
                created: customerId ? systemData.customers.find(c => c.id === customerId)?.created : new Date().toISOString(),
                updated: new Date().toISOString()
            };
            if (customerId) {
                const index = systemData.customers.findIndex(c => c.id === customerId);
                if (index !== -1) { systemData.customers[index] = customerData; showNotification('แก้ไขลูกค้าเรียบร้อยแล้ว', 'success'); }
            } else {
                systemData.customers.push(customerData);
                showNotification('เพิ่มลูกค้าเรียบร้อยแล้ว', 'success');
            }
            saveData();
            renderCustomers();
            resetCustomerForm();
            hideCustomerForm();
        }
        
        function editCustomer(id) {
            const customer = systemData.customers.find(c => c.id === id);
            if (!customer) return;
            document.getElementById('customer-id').value = customer.id;
            document.getElementById('customer-company').value = customer.company;
            document.getElementById('customer-type').value = customer.type;
            document.getElementById('customer-category').value = customer.category || '';
            document.getElementById('customer-address').value = customer.address || '';
            document.getElementById('customer-name').value = customer.name;
            document.getElementById('customer-phone').value = customer.phone;
            document.getElementById('customer-email').value = customer.email || '';
            document.getElementById('customer-note').value = customer.note || '';
            document.getElementById('customer-form-title').textContent = 'แก้ไขข้อมูลลูกค้า';
            document.getElementById('customer-form-icon').className = 'fas fa-edit text-xl';
            document.getElementById('submit-customer-btn').innerHTML = '<i class="fas fa-save"></i> บันทึกการแก้ไข';
            document.getElementById('cancel-edit-customer-btn').classList.remove('hidden');
            const form = document.getElementById('customer-form-container');
            form.classList.remove('form-hidden');
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        function deleteCustomer(id) {
            if (confirm("ลบข้อมูลลูกค้านี้?")) {
                systemData.customers = systemData.customers.filter(c => c.id !== id);
                saveData();
                renderCustomers();
                showNotification('ลบลูกค้าเรียบร้อยแล้ว', 'success');
            }
        }
        
        function resetCustomerForm() {
            document.getElementById('add-customer-form').reset();
            document.getElementById('customer-id').value = '';
            document.getElementById('customer-form-title').textContent = 'เพิ่มลูกค้าใหม่';
            document.getElementById('customer-form-icon').className = 'fas fa-user-plus text-xl';
            document.getElementById('submit-customer-btn').innerHTML = '<i class="fas fa-user-plus"></i> บันทึกข้อมูลลูกค้า';
            document.getElementById('cancel-edit-customer-btn').classList.add('hidden');
        }
        
        function renderCustomers() {
            const searchInput = document.getElementById('customer-search');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const filteredCustomers = systemData.customers.filter(c => 
                c.company.toLowerCase().includes(searchTerm) || c.name.toLowerCase().includes(searchTerm)
            );
            const customerList = document.getElementById('customer-list');
            if (!customerList) return;
            customerList.innerHTML = '';
            if (filteredCustomers.length === 0) {
                customerList.innerHTML = `<tr><td colspan="4" class="px-6 py-12 text-center text-slate-400"><div class="flex flex-col items-center gap-2"><i class="fas fa-search text-4xl opacity-20"></i><p>ไม่พบข้อมูลลูกค้า</p></div></td></tr>`;
            } else {
                filteredCustomers.forEach(c => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-slate-50 transition-colors';
                    row.innerHTML = `
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-bold text-slate-900">${escapeHtml(c.company)}</div><div class="text-sm text-slate-500">${escapeHtml(c.name)}</div></td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><span class="px-2.5 py-1 rounded-full text-[10px] font-bold uppercase ${c.type === 'ราชการ' ? 'bg-indigo-100 text-indigo-700' : c.type === 'รัฐวิสาหกิจ' ? 'bg-cyan-100 text-cyan-700' : 'bg-emerald-100 text-emerald-700'}">${c.type}</span></td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="flex flex-col gap-1"><div class="flex items-center gap-2 text-sm text-slate-600"><i class="fas fa-phone text-slate-400 text-sm"></i> ${escapeHtml(c.phone)}</div>${c.email ? `<div class="flex items-center gap-2 text-sm text-slate-600"><i class="fas fa-envelope text-slate-400 text-sm"></i> ${escapeHtml(c.email)}</div>` : ''}</div></td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4 text-right"><div class="flex items-center justify-end gap-2"><button onclick="editCustomer('${c.id}')" class="p-2 text-slate-400 hover:text-blue-600 transition-colors"><i class="fas fa-edit"></i></button><button onclick="deleteCustomer('${c.id}')" class="p-2 text-slate-400 hover:text-red-600 transition-colors"><i class="fas fa-trash"></i></button></div></td>
                    `;
                    customerList.appendChild(row);
                });
            }
            document.getElementById('customer-count').textContent = systemData.customers.length;
            populateOrderCustomerSelect();
            populateQuotationCustomerSelect();
        }
        
        // ========== PRODUCT ==========
        function toggleProductForm() {
            const form = document.getElementById('product-form-container');
            if (form) {
                form.classList.toggle('form-hidden');
                if (!form.classList.contains('form-hidden')) { resetProductForm(); form.scrollIntoView({ behavior: 'smooth' }); }
            }
        }
        
        function hideProductForm() { 
            const form = document.getElementById('product-form-container');
            if (form) { form.classList.add('form-hidden'); resetProductForm(); }
        }
        
        function filterProductCategory(category) {
            currentProductCategory = category;
            document.querySelectorAll('.product-category-tab').forEach(tab => {
                if (tab) { tab.classList.remove('bg-blue-600', 'text-white'); tab.classList.add('bg-slate-100', 'text-slate-700'); }
            });
            const activeTab = document.getElementById(`cat-${category === 'all' ? 'all' : category}`);
            if (activeTab) { activeTab.classList.remove('bg-slate-100', 'text-slate-700'); activeTab.classList.add('bg-blue-600', 'text-white'); }
            renderProducts();
        }
        
        function updateProductCode() {
            const productType = document.getElementById('product-type');
            if (!productType) return;
            const type = productType.value;
            if (type && productTypeCodes[type]) {
                const productCode = generateProductCode(type);
                const codeInput = document.getElementById('product-code');
                if (codeInput) codeInput.value = productCode;
            } else {
                const codeInput = document.getElementById('product-code');
                if (codeInput) codeInput.value = '';
            }
        }
        
        function insertSampleLink(type) {
            const input = document.getElementById('product-sample-link');
            if (!input) return;
            if (type === 'youtube') input.value = 'https://youtube.com/watch?v=';
            else if (type === 'tiktok') input.value = 'https://tiktok.com/@username/video/';
            else if (type === 'drive') input.value = 'https://drive.google.com/file/d/';
            input.focus();
        }
        
        function addProduct(event) {
            if (event) event.preventDefault();
            const name = document.getElementById('product-name');
            const price = document.getElementById('product-price');
            const type = document.getElementById('product-type');
            if (!name || !price || !type) return;
            const nameVal = name.value;
            const priceVal = price.value;
            const typeVal = type.value;
            const productId = document.getElementById('product-id').value;
            if (!nameVal || !priceVal || !typeVal) {
                showNotification('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'error');
                return;
            }
            const productData = {
                id: productId || `PROD-${Date.now()}`,
                code: document.getElementById('product-code').value || generateProductCode(typeVal),
                name: nameVal,
                type: typeVal,
                price: parseFloat(priceVal),
                promotion: document.getElementById('product-promotion').value,
                promotionDetail: document.getElementById('product-promotion').value === 'มี' ? document.getElementById('product-promotion-detail').value : undefined,
                sampleLink: document.getElementById('product-sample-link').value || '',
                note: document.getElementById('product-note').value,
                created: productId ? systemData.products.find(p => p.id === productId)?.created : new Date().toISOString(),
                updated: new Date().toISOString()
            };
            if (productId) {
                const index = systemData.products.findIndex(p => p.id === productId);
                if (index !== -1) { systemData.products[index] = productData; showNotification('แก้ไขสินค้าเรียบร้อยแล้ว', 'success'); }
            } else {
                systemData.products.push(productData);
                showNotification('เพิ่มสินค้าเรียบร้อยแล้ว', 'success');
            }
            saveData();
            renderProducts();
            resetProductForm();
            hideProductForm();
        }
        
        function editProduct(id) {
            const product = systemData.products.find(p => p.id === id);
            if (!product) return;
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-type').value = product.type;
            document.getElementById('product-code').value = product.code;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-promotion').value = product.promotion || 'ไม่มี';
            document.getElementById('product-promotion-detail').value = product.promotionDetail || '';
            document.getElementById('product-sample-link').value = product.sampleLink || '';
            document.getElementById('product-note').value = product.note || '';
            const promotionDetailContainer = document.getElementById('promotion-detail-container');
            if (promotionDetailContainer) promotionDetailContainer.classList.toggle('hidden', product.promotion !== 'มี');
            document.getElementById('product-form-title').textContent = 'แก้ไขสินค้า';
            document.getElementById('product-form-icon').className = 'fas fa-edit text-xl';
            document.getElementById('submit-product-btn').innerHTML = '<i class="fas fa-save"></i> บันทึกการแก้ไข';
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            const form = document.getElementById('product-form-container');
            form.classList.remove('form-hidden');
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        function deleteProduct(id) {
            if (confirm('ต้องการลบสินค้านี้หรือไม่?')) {
                systemData.products = systemData.products.filter(p => p.id !== id);
                saveData();
                renderProducts();
                showNotification('ลบสินค้าเรียบร้อยแล้ว', 'success');
            }
        }
        
        function resetProductForm() {
            const form = document.getElementById('add-product-form');
            if (form) form.reset();
            const productId = document.getElementById('product-id');
            if (productId) productId.value = '';
            const productCode = document.getElementById('product-code');
            if (productCode) productCode.value = '';
            const promotionContainer = document.getElementById('promotion-detail-container');
            if (promotionContainer) promotionContainer.classList.add('hidden');
            const title = document.getElementById('product-form-title');
            if (title) title.textContent = 'เพิ่มสินค้าใหม่';
            const icon = document.getElementById('product-form-icon');
            if (icon) icon.className = 'fas fa-plus text-xl';
            const submitBtn = document.getElementById('submit-product-btn');
            if (submitBtn) submitBtn.innerHTML = '<i class="fas fa-plus"></i> เพิ่มสินค้า';
            const cancelBtn = document.getElementById('cancel-edit-btn');
            if (cancelBtn) cancelBtn.classList.add('hidden');
            updateProductCode();
        }
        
        function renderProducts() {
            const searchInput = document.getElementById('product-search');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            let filteredProducts = systemData.products.filter(p => 
                p.name.toLowerCase().includes(searchTerm) || p.code.toLowerCase().includes(searchTerm)
            );
            if (currentProductCategory !== 'all') filteredProducts = filteredProducts.filter(p => p.type === currentProductCategory);
            const productList = document.getElementById('product-list');
            if (!productList) return;
            productList.innerHTML = '';
            if (filteredProducts.length === 0) {
                productList.innerHTML = `<tr><td colspan="7" class="px-6 py-12 text-center text-slate-400"><div class="flex flex-col items-center gap-2"><i class="fas fa-search text-4xl opacity-20"></i><p>ไม่พบข้อมูลสินค้า</p></div></td></tr>`;
            } else {
                filteredProducts.forEach((p, i) => {
                    const typeText = { 'onAir': 'On Air', 'online': 'Online', 'production': 'Production' }[p.type] || p.type;
                    const typeColor = { 'onAir': 'blue', 'online': 'emerald', 'production': 'amber' }[p.type] || 'gray';
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-slate-50 transition-colors';
                    row.innerHTML = `
                        <td class="px-4 lg:px-6 py-3 lg:py-4 text-center text-sm text-slate-500 font-bold">${i+1}</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-mono font-bold text-${typeColor}-600">${escapeHtml(p.code || 'ไม่มีรหัส')}</div></td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-bold text-slate-900">${escapeHtml(p.name)}</div>${p.note ? `<div class="text-xs text-slate-500 mt-1">${escapeHtml(p.note)}</div>` : ''}</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="flex items-center gap-2"><i class="fas ${p.type === 'onAir' ? 'fa-broadcast-tower text-blue-500' : p.type === 'online' ? 'fa-globe text-emerald-500' : 'fa-industry text-amber-500'}"></i><span class="text-sm text-slate-600">${typeText}</span></div></td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-bold text-blue-600">${p.price.toLocaleString()} ฿</div>${p.promotion === 'มี' && p.promotionDetail ? `<div class="text-xs text-emerald-600 font-bold">โปรโมชัน: ${escapeHtml(p.promotionDetail)}</div>` : ''}</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4">${p.sampleLink ? `<a href="${escapeHtml(p.sampleLink)}" target="_blank" class="text-blue-600 hover:underline text-sm flex items-center gap-1"><i class="fas fa-play-circle"></i> ดูตัวอย่าง</a>` : '<span class="text-slate-400 text-xs">ไม่มีตัวอย่าง</span>'}</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4 text-right"><div class="flex items-center justify-end gap-2"><button onclick="editProduct('${p.id}')" class="p-2 text-slate-400 hover:text-blue-600 transition-colors"><i class="fas fa-edit"></i></button><button onclick="deleteProduct('${p.id}')" class="p-2 text-slate-400 hover:text-red-600 transition-colors"><i class="fas fa-trash"></i></button></div></td>
                    `;
                    productList.appendChild(row);
                });
            }
            document.getElementById('product-count').textContent = systemData.products.length;
            populateOrderProductSelect();
        }
        
        // ========== PACKAGE ==========
        function togglePackageForm() {
            const form = document.getElementById('package-form-container');
            if (form) {
                form.classList.toggle('form-hidden');
                if (!form.classList.contains('form-hidden')) { resetPackageForm(); form.scrollIntoView({ behavior: 'smooth' }); }
            }
        }
        
        function hidePackageForm() { 
            const form = document.getElementById('package-form-container');
            if (form) { form.classList.add('form-hidden'); resetPackageForm(); }
        }
        
        function filterPackageCategory(category) {
            currentPackageCategory = category;
            document.querySelectorAll('.package-cat-btn').forEach(btn => {
                if (btn) { btn.classList.remove('bg-blue-600', 'text-white'); btn.classList.add('bg-slate-100', 'text-slate-700'); }
            });
            const activeTab = document.getElementById(`package-cat-${category === 'all' ? 'all' : category}`);
            if (activeTab) { activeTab.classList.remove('bg-slate-100', 'text-slate-700'); activeTab.classList.add('bg-blue-600', 'text-white'); }
            renderPackageProducts();
        }
        
        function renderPackageProducts() {
            const container = document.getElementById('package-products-container');
            if (!container) return;
            container.innerHTML = '';
            if (systemData.products.length === 0) {
                container.innerHTML = `<div class="text-center text-slate-400 py-4"><i class="fas fa-box text-2xl opacity-20 mb-2"></i><p>ยังไม่มีสินค้า</p><p class="text-sm">ไปที่เมนู Product เพื่อเพิ่มสินค้าก่อน</p></div>`;
                return;
            }
            let filteredProducts = systemData.products;
            if (currentPackageCategory !== 'all') filteredProducts = filteredProducts.filter(p => p.type === currentPackageCategory);
            filteredProducts.forEach(product => {
                const isSelected = selectedPackageProducts.some(p => p.id === product.id);
                const div = document.createElement('div');
                div.className = `package-product-item flex items-center justify-between p-3 rounded-lg border cursor-pointer ${isSelected ? 'selected bg-blue-50 border-blue-200' : 'bg-white border-slate-200 hover:bg-slate-50'}`;
                div.onclick = () => togglePackageProduct(product.id);
                div.innerHTML = `<div class="flex items-center gap-3 flex-1"><input type="checkbox" id="product-${product.id}" class="h-4 w-4 text-blue-600 rounded pointer-events-none" ${isSelected ? 'checked' : ''}><div class="flex-1"><div class="font-medium text-slate-900">${escapeHtml(product.code)} - ${escapeHtml(product.name)}</div><div class="text-sm text-slate-500">${product.type === 'onAir' ? 'On Air' : product.type === 'online' ? 'Online' : 'Production'}</div></div><div class="text-sm font-bold text-blue-600">${product.price.toLocaleString()} ฿</div></div>`;
                container.appendChild(div);
            });
            updateSelectedProductsCount();
        }
        
        function togglePackageProduct(productId) {
            const product = systemData.products.find(p => p.id === productId);
            if (!product) return;
            const index = selectedPackageProducts.findIndex(p => p.id === productId);
            if (index === -1) selectedPackageProducts.push(product);
            else selectedPackageProducts.splice(index, 1);
            updateSelectedProductsCount();
            renderPackageProducts();
            updateSelectedProductsSummary();
        }
        
        function updateSelectedProductsCount() {
            const countElement = document.getElementById('selected-products-count');
            if (countElement) countElement.textContent = `เลือกแล้ว: ${selectedPackageProducts.length} รายการ`;
            const summarySection = document.getElementById('selected-products-summary');
            if (summarySection) summarySection.classList.toggle('hidden', selectedPackageProducts.length === 0);
        }
        
        function updateSelectedProductsSummary() {
            const listContainer = document.getElementById('selected-products-list');
            const totalPriceElement = document.getElementById('package-total-price');
            if (!listContainer || !totalPriceElement) return;
            listContainer.innerHTML = '';
            if (selectedPackageProducts.length === 0) return;
            let totalPrice = 0;
            selectedPackageProducts.forEach(p => {
                totalPrice += p.price;
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex justify-between text-sm';
                itemDiv.innerHTML = `<span class="text-slate-700">${escapeHtml(p.code)} - ${escapeHtml(p.name)}</span><span class="font-bold text-slate-900">${p.price.toLocaleString()} ฿</span>`;
                listContainer.appendChild(itemDiv);
            });
            totalPriceElement.textContent = `${totalPrice.toLocaleString()} ฿`;
            const packagePriceInput = document.getElementById('package-price');
            if (packagePriceInput && !packagePriceInput.value) packagePriceInput.value = totalPrice;
        }
        
        function showPackageDetail(id) {
            const pkg = systemData.packages.find(p => p.id === id);
            if (!pkg) return;
            const modal = document.getElementById('package-detail-modal');
            const modalContent = document.getElementById('modal-package-detail');
            if (!modal || !modalContent) return;
            let productsHtml = ''; let totalPrice = 0;
            pkg.products.forEach(product => {
                productsHtml += `<tr class="border-b"><td class="py-2">${escapeHtml(product.code)}</td><td class="py-2">${escapeHtml(product.name)}</td><td class="py-2">${product.type === 'onAir' ? 'On Air' : product.type === 'online' ? 'Online' : 'Production'}</td><td class="py-2 text-right">${product.price.toLocaleString()} ฿</td></tr>`;
                totalPrice += product.price;
            });
            const discountAmount = pkg.price * (pkg.discount / 100);
            const finalPrice = pkg.price - discountAmount;
            modalContent.innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4"><div><p class="text-sm text-slate-500">รหัสแพ็กเกจ</p><p class="font-bold text-lg">${escapeHtml(pkg.code)}</p></div><div><p class="text-sm text-slate-500">ชื่อแพ็กเกจ</p><p class="font-bold text-lg">${escapeHtml(pkg.name)}</p></div></div>
                    ${pkg.description ? `<div><p class="text-sm text-slate-500">รายละเอียด</p><p class="text-slate-700">${escapeHtml(pkg.description)}</p></div>` : ''}
                    <div><p class="text-sm text-slate-500 mb-2">สินค้าในแพ็กเกจ (${pkg.products.length} รายการ)</p><div class="bg-slate-50 rounded-lg p-3 max-h-60 overflow-y-auto"><table class="w-full text-sm"><thead><tr class="text-slate-500 border-b"><th class="text-left py-2">รหัส</th><th class="text-left py-2">ชื่อสินค้า</th><th class="text-left py-2">ประเภท</th><th class="text-right py-2">ราคา</th></tr></thead><tbody>${productsHtml}</tbody><tfoot class="border-t font-bold"><tr><td colspan="3" class="py-2 text-right">ราคารวม:</td><td class="py-2 text-right">${totalPrice.toLocaleString()} ฿</td></tr></tfoot></table></div></div>
                    <div class="grid grid-cols-2 gap-4 pt-4 border-t"><div><p class="text-sm text-slate-500">ราคาแพ็กเกจ</p><p class="font-bold text-lg text-blue-600">${pkg.price.toLocaleString()} ฿</p></div>${pkg.discount > 0 ? `<div><p class="text-sm text-slate-500">ส่วนลด</p><p class="font-bold text-lg text-emerald-600">${pkg.discount}% (${discountAmount.toLocaleString()} ฿)</p></div><div class="col-span-2"><p class="text-sm text-slate-500">ราคาสุทธิ</p><p class="font-bold text-2xl text-emerald-600">${finalPrice.toLocaleString()} ฿</p></div>` : ''}</div>
                    ${pkg.note ? `<div class="bg-blue-50 p-3 rounded-lg"><p class="text-sm text-slate-500">หมายเหตุ</p><p class="text-slate-700">${escapeHtml(pkg.note)}</p></div>` : ''}
                    <div class="flex justify-end gap-3 pt-4"><button onclick="editPackage('${pkg.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold"><i class="fas fa-edit"></i> แก้ไข</button><button onclick="deletePackage('${pkg.id}')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold"><i class="fas fa-trash"></i> ลบ</button><button onclick="closePackageModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-bold">ปิด</button></div>
                </div>`;
            document.getElementById('modal-package-name').textContent = pkg.name;
            modal.classList.add('show');
        }
        
        function closePackageModal() {
            const modal = document.getElementById('package-detail-modal');
            if (modal) modal.classList.remove('show');
        }
        
        function addPackage(event) {
            if (event) event.preventDefault();
            const nameInput = document.getElementById('package-name');
            const priceInput = document.getElementById('package-price');
            if (!nameInput || !priceInput) return;
            const name = nameInput.value;
            const price = priceInput.value;
            const packageId = document.getElementById('package-id').value;
            if (!name || !price) { showNotification('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'error'); return; }
            if (selectedPackageProducts.length === 0) { showNotification('กรุณาเลือกสินค้าอย่างน้อย 1 รายการ', 'error'); return; }
            const packageData = {
                id: packageId || `PKG-${Date.now()}`,
                code: document.getElementById('package-code').value || generatePackageCode(),
                name: name,
                description: document.getElementById('package-description').value || '',
                products: selectedPackageProducts.map(p => ({ id: p.id, code: p.code, name: p.name, type: p.type, price: p.price })),
                price: parseFloat(price),
                discount: parseFloat(document.getElementById('package-discount').value) || 0,
                note: document.getElementById('package-note').value || '',
                created: packageId ? systemData.packages.find(p => p.id === packageId)?.created : new Date().toISOString(),
                updated: new Date().toISOString()
            };
            if (packageId) {
                const index = systemData.packages.findIndex(p => p.id === packageId);
                if (index !== -1) { systemData.packages[index] = packageData; showNotification('แก้ไขแพ็กเกจเรียบร้อยแล้ว', 'success'); }
            } else {
                systemData.packages.push(packageData);
                showNotification('สร้างแพ็กเกจเรียบร้อยแล้ว', 'success');
            }
            updatePackageCounter();
            saveData();
            renderPackages();
            resetPackageForm();
            hidePackageForm();
        }
        
        function editPackage(id) {
            const pkg = systemData.packages.find(p => p.id === id);
            if (!pkg) return;
            document.getElementById('package-id').value = pkg.id;
            document.getElementById('package-name').value = pkg.name;
            document.getElementById('package-code').value = pkg.code;
            document.getElementById('package-description').value = pkg.description || '';
            document.getElementById('package-price').value = pkg.price;
            document.getElementById('package-discount').value = pkg.discount || 0;
            document.getElementById('package-note').value = pkg.note || '';
            selectedPackageProducts = [];
            pkg.products.forEach(pd => {
                const product = systemData.products.find(p => p.id === pd.id);
                if (product) selectedPackageProducts.push(product);
            });
            document.getElementById('package-form-title').textContent = 'แก้ไขแพ็กเกจ';
            document.getElementById('package-form-icon').className = 'fas fa-edit text-xl';
            document.getElementById('submit-package-btn').innerHTML = '<i class="fas fa-save"></i> บันทึกการแก้ไข';
            document.getElementById('cancel-edit-package-btn').classList.remove('hidden');
            renderPackageProducts();
            updateSelectedProductsSummary();
            const form = document.getElementById('package-form-container');
            form.classList.remove('form-hidden');
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        function deletePackage(id) {
            if (confirm('ต้องการลบแพ็กเกจนี้หรือไม่?')) {
                systemData.packages = systemData.packages.filter(p => p.id !== id);
                updatePackageCounter();
                saveData();
                renderPackages();
                showNotification('ลบแพ็กเกจเรียบร้อยแล้ว', 'success');
            }
        }
        
        function resetPackageForm() {
            const form = document.getElementById('add-package-form');
            if (form) form.reset();
            const packageId = document.getElementById('package-id');
            if (packageId) packageId.value = '';
            const packageCode = document.getElementById('package-code');
            if (packageCode) packageCode.value = generatePackageCode();
            selectedPackageProducts = [];
            const title = document.getElementById('package-form-title');
            if (title) title.textContent = 'สร้างแพ็กเกจใหม่';
            const icon = document.getElementById('package-form-icon');
            if (icon) icon.className = 'fas fa-plus text-xl';
            const submitBtn = document.getElementById('submit-package-btn');
            if (submitBtn) submitBtn.innerHTML = '<i class="fas fa-plus"></i> สร้างแพ็กเกจ';
            const cancelBtn = document.getElementById('cancel-edit-package-btn');
            if (cancelBtn) cancelBtn.classList.add('hidden');
            const summarySection = document.getElementById('selected-products-summary');
            if (summarySection) summarySection.classList.add('hidden');
            updateSelectedProductsCount();
            renderPackageProducts();
        }
        
        function renderPackages() {
            const searchInput = document.getElementById('package-search');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const filteredPackages = systemData.packages.filter(p => 
                p.name.toLowerCase().includes(searchTerm) || p.code.toLowerCase().includes(searchTerm)
            );
            const packageList = document.getElementById('package-list');
            if (!packageList) return;
            packageList.innerHTML = '';
            if (filteredPackages.length === 0) {
                packageList.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-slate-400"><div class="flex flex-col items-center gap-2"><i class="fas fa-boxes text-4xl opacity-20"></i><p>ยังไม่มีรายการแพ็กเกจ</p><p class="text-sm">คลิกปุ่ม "สร้างแพ็กเกจใหม่" เพื่อเริ่มต้น</p></div></td></tr>`;
            } else {
                filteredPackages.forEach((p, i) => {
                    const totalProducts = p.products?.length || 0;
                    const discountAmount = p.price * (p.discount / 100);
                    const finalPrice = p.price - discountAmount;
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-slate-50 transition-colors';
                    row.innerHTML = `
                        <td class="px-4 lg:px-6 py-3 lg:py-4 text-center text-sm text-slate-500 font-bold">${i+1}</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-mono font-bold text-purple-600">${escapeHtml(p.code)}</div></td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-bold text-slate-900">${escapeHtml(p.name)}</div>${p.description ? `<div class="text-xs text-slate-500 mt-1">${escapeHtml(p.description.substring(0,50))}${p.description.length > 50 ? '...' : ''}</div>` : ''}</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4 text-center font-medium">${totalProducts} รายการ</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-bold text-blue-600">${p.price.toLocaleString()} ฿</div>${p.discount > 0 ? `<div class="text-xs text-emerald-600 font-bold">ลด ${p.discount}% (${finalPrice.toLocaleString()} ฿)</div>` : ''}</td>
                        <td class="px-4 lg:px-6 py-3 lg:py-4 text-right"><div class="flex items-center justify-end gap-2"><button onclick="showPackageDetail('${p.id}')" class="p-2 text-slate-400 hover:text-blue-600 transition-colors" title="ดูรายละเอียด"><i class="fas fa-eye"></i></button><button onclick="editPackage('${p.id}')" class="p-2 text-slate-400 hover:text-blue-600 transition-colors"><i class="fas fa-edit"></i></button><button onclick="deletePackage('${p.id}')" class="p-2 text-slate-400 hover:text-red-600 transition-colors"><i class="fas fa-trash"></i></button></div></td>
                    `;
                    packageList.appendChild(row);
                });
            }
            const countElement = document.getElementById('package-count');
            if (countElement) countElement.textContent = systemData.packages.length;
            updatePackageCounter();
        }
        
        // ========== ORDER ==========
        function initializeOrdersTab() {
            if (!document.getElementById('orders-tab')) return;
            generateTimeSlots();
            generateWeekdays();
            populateOrderCustomerSelect();
            populateOrderProductSelect();
            updateOrderCalculation();
            const today = new Date();
            const endDate = new Date(); endDate.setDate(today.getDate() + 30);
            const startDateInput = document.getElementById('order-start-date');
            const endDateInput = document.getElementById('order-end-date');
            if (startDateInput) startDateInput.value = today.toISOString().split('T')[0];
            if (endDateInput) endDateInput.value = endDate.toISOString().split('T')[0];
            currentOrder.startDate = today.toISOString().split('T')[0];
            currentOrder.endDate = endDate.toISOString().split('T')[0];
            setupOrderEventListeners();
            updateOrdersTable();
            updateCampaignTotal();
        }
        
        function setupOrderEventListeners() {
            const customerSelect = document.getElementById('order-customer');
            if (customerSelect) customerSelect.addEventListener('change', function(e) { currentOrder.selectedCustomerId = e.target.value; updateCustomerInfo(); updateOrderCalculation(); });
            const productSelect = document.getElementById('order-product');
            if (productSelect) productSelect.addEventListener('change', function(e) { currentOrder.selectedItemId = e.target.value; updateOrderCalculation(); });
            const paymentType = document.getElementById('order-payment-type');
            if (paymentType) paymentType.addEventListener('change', function(e) { currentOrder.paymentType = e.target.value; updateOrderCalculation(); });
            const startDate = document.getElementById('order-start-date');
            if (startDate) startDate.addEventListener('change', function(e) { currentOrder.startDate = e.target.value; updateOrderCalculation(); });
            const endDate = document.getElementById('order-end-date');
            if (endDate) endDate.addEventListener('change', function(e) { currentOrder.endDate = e.target.value; updateOrderCalculation(); });
            const orderNote = document.getElementById('order-note');
            if (orderNote) orderNote.addEventListener('input', function(e) { currentOrder.note = e.target.value; });
        }
        
        function generateTimeSlots() {
            const container = document.getElementById('time-slots-container');
            if (!container) return;
            container.innerHTML = '';
            const allSlots = TIME_SLOTS.flatMap(p => p.slots);
            allSlots.forEach(slot => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'time-slot-btn py-2 px-1 text-[10px] sm:text-[11px] font-bold rounded-lg border bg-slate-50 border-slate-200 text-slate-600 hover:border-blue-300';
                btn.textContent = slot;
                btn.dataset.slot = slot;
                btn.addEventListener('click', function() {
                    const s = this.dataset.slot;
                    if (currentOrder.selectedSlots.includes(s)) {
                        currentOrder.selectedSlots = currentOrder.selectedSlots.filter(x => x !== s);
                        this.classList.remove('selected', 'bg-blue-600', 'border-blue-600', 'text-white', 'shadow-md', 'scale-[1.02]');
                    } else {
                        currentOrder.selectedSlots.push(s);
                        this.classList.add('selected', 'bg-blue-600', 'border-blue-600', 'text-white', 'shadow-md', 'scale-[1.02]');
                    }
                    updateSelectedSlotsCount();
                    updateOrderCalculation();
                });
                container.appendChild(btn);
            });
            updateSelectedSlotsCount();
        }
        
        function generateWeekdays() {
            const container = document.getElementById('weekdays-container');
            if (!container) return;
            container.innerHTML = '';
            WEEKDAYS.forEach(day => {
                const btn = document.createElement('button');
                btn.type = 'button';
                const isSelected = currentOrder.selectedDays.includes(day.value);
                btn.className = `weekday-btn w-8 h-8 lg:w-9 lg:h-9 flex items-center justify-center rounded-full text-xs font-bold transition-all border ${isSelected ? 'bg-blue-600 border-blue-600 text-white selected' : 'bg-slate-100 border-slate-200 text-slate-400'}`;
                btn.textContent = day.label;
                btn.dataset.day = day.value;
                btn.addEventListener('click', function() {
                    const val = parseInt(this.dataset.day);
                    if (currentOrder.selectedDays.includes(val)) {
                        currentOrder.selectedDays = currentOrder.selectedDays.filter(d => d !== val);
                        this.classList.remove('bg-blue-600', 'border-blue-600', 'text-white', 'selected');
                        this.classList.add('bg-slate-100', 'border-slate-200', 'text-slate-400');
                    } else {
                        currentOrder.selectedDays.push(val);
                        this.classList.remove('bg-slate-100', 'border-slate-200', 'text-slate-400');
                        this.classList.add('bg-blue-600', 'border-blue-600', 'text-white', 'selected');
                    }
                    updateOrderCalculation();
                });
                container.appendChild(btn);
            });
        }
        
        function populateOrderCustomerSelect() {
            const select = document.getElementById('order-customer');
            if (!select) return;
            select.innerHTML = '<option value="">-- เลือกลูกค้า --</option>';
            systemData.customers.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = `${c.company} (${c.name})`;
                select.appendChild(opt);
            });
        }
        
        function populateOrderProductSelect() {
            const select = document.getElementById('order-product');
            if (!select) return;
            select.innerHTML = '<option value="">-- เลือกรายการ --</option>';
            let availableItems = [];
            if (currentOrder.orderType === 'Produce') availableItems = systemData.products.filter(p => p.type !== 'production');
            else if (currentOrder.orderType === 'Package') availableItems = systemData.packages;
            else availableItems = systemData.products.filter(p => p.type === 'production');
            availableItems.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                const price = item.price || item.totalPrice || 0;
                opt.textContent = `${item.code ? item.code + ' - ' : ''}${item.name} (${price.toLocaleString()} ฿)`;
                select.appendChild(opt);
            });
        }
        
        function setOrderType(type) {
            currentOrder.orderType = type;
            currentOrder.selectedItemId = '';
            document.querySelectorAll('.order-type-btn').forEach(btn => btn?.classList.remove('active'));
            const activeBtn = document.getElementById(`order-type-${type.toLowerCase()}`);
            if (activeBtn) activeBtn.classList.add('active');
            populateOrderProductSelect();
            updateOrderCalculation();
        }
        
        function updateCustomerInfo() {
            const display = document.getElementById('customer-type-display');
            const typeText = document.getElementById('selected-customer-type');
            if (!display || !typeText) return;
            const selected = systemData.customers.find(c => c.id === currentOrder.selectedCustomerId);
            if (selected) {
                display.classList.remove('hidden');
                typeText.textContent = selected.type === 'เอกชน' ? 'เอกชน' : selected.type === 'ราชการ' ? 'ราชการ' : 'รัฐวิสาหกิจ';
            } else display.classList.add('hidden');
        }
        
        function updateSelectedSlotsCount() {
            const el = document.getElementById('selected-slots-count');
            if (el) el.textContent = `เลือกแล้ว: ${currentOrder.selectedSlots.length} ครั้ง/วัน`;
        }
        
        function calculateOrder() {
            const customer = systemData.customers.find(c => c.id === currentOrder.selectedCustomerId);
            let item = null;
            if (currentOrder.orderType === 'Package') item = systemData.packages.find(p => p.id === currentOrder.selectedItemId);
            else item = systemData.products.find(p => p.id === currentOrder.selectedItemId);
            if (!item || !currentOrder.startDate || !currentOrder.endDate) return null;
            const start = new Date(currentOrder.startDate);
            const end = new Date(currentOrder.endDate);
            if (end < start) return null;
            let totalDays = 0;
            const cur = new Date(start);
            while (cur <= end) {
                if (currentOrder.selectedDays.includes(cur.getDay())) totalDays++;
                cur.setDate(cur.getDate() + 1);
            }
            const unitPrice = item.price || item.totalPrice || 0;
            const timesPerDay = currentOrder.selectedSlots.length || 1;
            const baseTotal = unitPrice * timesPerDay * totalDays;
            let conditionDiscountPercent = 0, conditionDiscountReason = '';
            const diffDays = Math.ceil(Math.abs(end.getTime() - start.getTime()) / (1000*60*60*24)) + 1;
            const totalMonths = diffDays / 30;
            const activeType = customer?.type || 'เอกชน';
            if (activeType === 'ราชการ') { conditionDiscountPercent = 40; conditionDiscountReason = 'ส่วนลดสำหรับลูกค้าราชการ'; }
            else {
                if (totalMonths >= 6) { conditionDiscountPercent = 30; conditionDiscountReason = 'ส่วนลดระยะยาว (6 เดือนขึ้นไป)'; }
                else if (totalMonths >= 3) { conditionDiscountPercent = 25; conditionDiscountReason = 'ส่วนลดระยะกลาง (3-6 เดือน)'; }
                else if (totalMonths >= 2) { conditionDiscountPercent = 20; conditionDiscountReason = 'ส่วนลดระยะสั้น (2-3 เดือน)'; }
            }
            const paymentDiscountPercent = currentOrder.paymentType === 'ก่อนออกอากาศ' ? 5 : 0;
            const paymentDiscountReason = paymentDiscountPercent > 0 ? 'ส่วนลดจ่ายล่วงหน้า' : '';
            const conditionDiscountAmount = baseTotal * (conditionDiscountPercent / 100);
            const paymentDiscountAmount = (baseTotal - conditionDiscountAmount) * (paymentDiscountPercent / 100);
            const totalDiscountAmount = conditionDiscountAmount + paymentDiscountAmount;
            const priceAfterDiscount = baseTotal - totalDiscountAmount;
            const vatAmount = priceAfterDiscount * 0.07;
            const netTotal = priceAfterDiscount + vatAmount;
            return { totalDays, timesPerDay, baseTotal, conditionDiscountPercent, conditionDiscountReason, paymentDiscountPercent, paymentDiscountReason, totalDiscountAmount, priceAfterDiscount, vatAmount, netTotal, totalMonths };
        }
        
        function updateOrderCalculation() {
            const result = calculateOrder();
            const summaryElement = document.getElementById('calculation-summary');
            if (!summaryElement) return;
            if (!result) {
                summaryElement.innerHTML = `<div class="py-8 lg:py-12 flex flex-col items-center justify-center text-slate-300 gap-3 text-center"><i class="fas fa-calculator text-3xl lg:text-4xl opacity-20"></i><p class="text-xs">ระบุข้อมูลลูกค้า วันออกอากาศ<br/>และเลือกสินค้าเพื่อคำนวณราคา</p></div>`;
                return;
            }
            let discountExplanation = '';
            if (result.conditionDiscountPercent > 0) discountExplanation += `<div class="text-xs text-emerald-700 bg-emerald-50 p-2 rounded-lg mb-2">${result.conditionDiscountReason}: ${result.conditionDiscountPercent}%</div>`;
            if (result.paymentDiscountPercent > 0) discountExplanation += `<div class="text-xs text-blue-700 bg-blue-50 p-2 rounded-lg">${result.paymentDiscountReason}: ${result.paymentDiscountPercent}%</div>`;
            summaryElement.innerHTML = `
                <div class="space-y-3 pb-4 border-b border-slate-100">
                    <div class="flex justify-between text-sm"><span class="text-slate-500">จำนวนวันออกอากาศ:</span><span class="font-bold">${result.totalDays} วัน</span></div>
                    <div class="flex justify-between text-sm"><span class="text-slate-500">จำนวนครั้งต่อวัน:</span><span class="font-bold text-blue-600">${result.timesPerDay} ครั้ง</span></div>
                    <div class="flex justify-between text-sm"><span class="text-slate-500">ระยะเวลาแคมเปญ:</span><span class="font-bold text-slate-900">${result.totalMonths.toFixed(1)} เดือน</span></div>
                    <div class="flex justify-between text-sm"><span class="text-slate-500">ราคาก่อนหักส่วนลด:</span><span class="font-bold">${result.baseTotal.toLocaleString()} ฿</span></div>
                </div>
                <div class="space-y-3 pb-4 border-b border-slate-100">
                    ${discountExplanation}
                    <div class="flex justify-between text-sm text-emerald-600"><span class="flex items-center gap-1 font-bold"><i class="fas fa-tag text-xs"></i> ส่วนลดเงื่อนไข (${result.conditionDiscountPercent}%):</span><span class="font-bold">- ${(result.baseTotal * result.conditionDiscountPercent / 100).toLocaleString()} ฿</span></div>
                    ${result.paymentDiscountPercent > 0 ? `<div class="flex justify-between text-sm text-emerald-600"><span class="flex items-center gap-1 font-bold"><i class="fas fa-credit-card text-xs"></i> ส่วนลดจ่ายล่วงหน้า (${result.paymentDiscountPercent}%):</span><span class="font-bold">- ${((result.baseTotal - (result.baseTotal * result.conditionDiscountPercent / 100)) * result.paymentDiscountPercent / 100).toLocaleString()} ฿</span></div>` : ''}
                </div>
                <div class="space-y-2 pt-2">
                    <div class="flex justify-between text-sm"><span class="text-slate-500">ราคาหลังส่วนลด:</span><span class="font-bold text-slate-900">${result.priceAfterDiscount.toLocaleString()} ฿</span></div>
                    <div class="flex justify-between text-sm"><span class="text-slate-500">VAT (7%):</span><span class="font-bold text-slate-900">${result.vatAmount.toLocaleString()} ฿</span></div>
                    <div class="flex justify-between items-center pt-2"><span class="text-lg font-bold text-blue-900">ยอดสุทธิ:</span><span class="text-2xl font-black text-blue-600">${result.netTotal.toLocaleString()} ฿</span></div>
                </div>`;
        }
        
        function addOrderToCampaign() {
            const customer = systemData.customers.find(c => c.id === currentOrder.selectedCustomerId);
            let item = null;
            if (currentOrder.orderType === 'Package') item = systemData.packages.find(p => p.id === currentOrder.selectedItemId);
            else item = systemData.products.find(p => p.id === currentOrder.selectedItemId);
            if (!customer || !item) { showNotification('กรุณาเลือกลูกค้าและสินค้าก่อนเพิ่มรายการ', 'error'); return; }
            const calc = calculateOrder();
            if (!calc) return;
            const newOrder = {
                id: `ORD-${Date.now()}`,
                customerId: currentOrder.selectedCustomerId,
                customerName: customer.company,
                productType: currentOrder.orderType,
                productId: item.id,
                productCode: item.code || '',
                productName: item.name,
                unitPrice: item.price || item.totalPrice || 0,
                timeSlots: [...currentOrder.selectedSlots],
                startDate: currentOrder.startDate,
                endDate: currentOrder.endDate,
                daysOfWeek: [...currentOrder.selectedDays],
                timesPerDay: calc.timesPerDay,
                totalDays: calc.totalDays,
                totalPrice: calc.baseTotal,
                conditionDiscountPercent: calc.conditionDiscountPercent,
                conditionDiscountReason: calc.conditionDiscountReason,
                paymentDiscountPercent: calc.paymentDiscountPercent,
                paymentDiscountReason: calc.paymentDiscountReason,
                totalDiscountAmount: calc.totalDiscountAmount,
                priceAfterDiscount: calc.priceAfterDiscount,
                vatAmount: calc.vatAmount,
                netTotal: calc.netTotal,
                paymentType: currentOrder.paymentType,
                note: currentOrder.note,
                created: new Date().toISOString()
            };
            systemData.orders.push(newOrder);
            saveData();
            updateOrdersTable();
            updateCampaignTotal();
            resetOrderForm();
            showNotification('เพิ่มรายการสั่งซื้อเรียบร้อยแล้ว', 'success');
        }
        
        function deleteOrder(id) {
            if (confirm('ต้องการลบรายการสั่งซื้อนี้หรือไม่?')) {
                systemData.orders = systemData.orders.filter(o => o.id !== id);
                saveData();
                updateOrdersTable();
                updateCampaignTotal();
                showNotification('ลบรายการสั่งซื้อเรียบร้อยแล้ว', 'success');
            }
        }
        
        function updateOrdersTable() {
            const tbody = document.getElementById('orders-table-body');
            const countElement = document.getElementById('orders-count');
            if (!tbody || !countElement) return;
            countElement.textContent = systemData.orders.length;
            if (systemData.orders.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-slate-400">ยังไม่มีรายการสั่งซื้อในแคมเปญนี้</td></tr>`;
                return;
            }
            tbody.innerHTML = '';
            systemData.orders.forEach(o => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-slate-50 transition-colors';
                row.innerHTML = `
                    <td class="px-4 lg:px-6 py-3 lg:py-4"><div class="font-bold text-slate-800">${escapeHtml(o.productCode ? o.productCode + ' - ' : '')}${escapeHtml(o.productName)}</div><div class="text-[10px] text-slate-400 mt-1 font-mono">${formatDate(o.startDate)} - ${formatDate(o.endDate)}</div>${o.note ? `<div class="text-xs text-blue-600 mt-1">* ${escapeHtml(o.note)}</div>` : ''}</td>
                    <td class="px-4 lg:px-6 py-3 lg:py-4 text-center font-medium">${o.totalDays} วัน</td>
                    <td class="px-4 lg:px-6 py-3 lg:py-4 text-center font-medium">${o.timesPerDay} ครั้ง/วัน</td>
                    <td class="px-4 lg:px-6 py-3 lg:py-4 text-right"><div class="text-emerald-600 font-bold">- ${o.totalDiscountAmount.toLocaleString()}</div><div class="text-[10px] text-slate-500 mt-1">${o.conditionDiscountReason || ''}${o.paymentDiscountReason ? (o.conditionDiscountReason ? ' + ' : '') + o.paymentDiscountReason : ''}</div></td>
                    <td class="px-4 lg:px-6 py-3 lg:py-4 text-right font-black text-blue-600">${o.netTotal.toLocaleString()}</td>
                    <td class="px-4 lg:px-6 py-3 lg:py-4 text-center"><button onclick="deleteOrder('${o.id}')" class="p-2 text-slate-300 hover:text-red-500 transition-colors"><i class="fas fa-trash"></i></button></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateCampaignTotal() {
            const total = systemData.orders.reduce((acc, curr) => ({ base: acc.base + curr.totalPrice, discount: acc.discount + curr.totalDiscountAmount, net: acc.net + curr.netTotal }), { base: 0, discount: 0, net: 0 });
            const totalElement = document.getElementById('campaign-total');
            const discountElement = document.getElementById('campaign-discount');
            const netElement = document.getElementById('campaign-net');
            if (totalElement) totalElement.textContent = `${total.base.toLocaleString()} ฿`;
            if (discountElement) discountElement.textContent = `- ${total.discount.toLocaleString()} ฿`;
            if (netElement) netElement.textContent = `${total.net.toLocaleString()} ฿`;
        }
        
        function resetOrderForm() {
            currentOrder.selectedItemId = '';
            currentOrder.selectedSlots = [];
            currentOrder.note = '';
            const productSelect = document.getElementById('order-product');
            const orderNote = document.getElementById('order-note');
            if (productSelect) productSelect.value = '';
            if (orderNote) orderNote.value = '';
            document.querySelectorAll('.time-slot-btn').forEach(btn => {
                if (btn) {
                    btn.classList.remove('selected', 'bg-blue-600', 'border-blue-600', 'text-white', 'shadow-md', 'scale-[1.02]');
                    btn.classList.add('bg-slate-50', 'border-slate-200', 'text-slate-600');
                }
            });
            updateSelectedSlotsCount();
            updateOrderCalculation();
        }
        
        // ========== QUOTATION ==========
        function populateQuotationCustomerSelect() {
            const select = document.getElementById('quotation-customer');
            if (!select) return;
            select.innerHTML = '<option value="">-- เลือกลูกค้า --</option>';
            systemData.customers.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = c.company;
                select.appendChild(opt);
            });
        }
        
        function loadCustomerQuotation() {
            const customerId = document.getElementById('quotation-customer').value;
            if (!customerId) {
                const preview = document.getElementById('quotation-preview');
                const empty = document.getElementById('quotation-empty');
                if (preview) preview.classList.add('hidden');
                if (empty) empty.classList.remove('hidden');
                return;
            }
            const customer = systemData.customers.find(c => c.id === customerId);
            const customerOrders = systemData.orders.filter(o => o.customerId === customerId);
            if (!customer || customerOrders.length === 0) {
                const preview = document.getElementById('quotation-preview');
                const empty = document.getElementById('quotation-empty');
                if (preview) preview.classList.add('hidden');
                if (empty) empty.classList.remove('hidden');
                return;
            }
            let beforeVat = 0, vat = 0, total = 0;
            customerOrders.forEach(o => { beforeVat += (o.netTotal - o.vatAmount); vat += o.vatAmount; total += o.netTotal; });
            const companyEl = document.getElementById('quotation-company');
            const addressEl = document.getElementById('quotation-address');
            const phoneEl = document.getElementById('quotation-phone');
            const dateEl = document.getElementById('quotation-date');
            const staffEl = document.getElementById('quotation-staff-name');
            const staffNameInput = document.getElementById('staff-name');
            if (companyEl) companyEl.textContent = customer.company;
            if (addressEl) addressEl.textContent = customer.address || '-';
            if (phoneEl) phoneEl.textContent = customer.phone || '-';
            if (dateEl) dateEl.textContent = new Date().toLocaleDateString('th-TH', { day: '2-digit', month: 'long', year: 'numeric' });
            if (staffEl) staffEl.textContent = staffNameInput ? staffNameInput.value : 'ฝ่ายขาย';
            const itemsContainer = document.getElementById('quotation-items');
            if (itemsContainer) {
                itemsContainer.innerHTML = '';
                customerOrders.forEach((o, i) => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-slate-200';
                    row.innerHTML = `<td class="p-2 lg:p-3"><p class="font-bold text-slate-900">${i+1}. ${escapeHtml(o.productCode ? o.productCode + ' - ' : '')}${escapeHtml(o.productName)}</p>${o.note ? `<p class="text-[10px] text-blue-600 mt-0.5">* ${escapeHtml(o.note)}</p>` : ''}</td><td class="p-2 lg:p-3 text-center font-bold">${o.totalDays}</td><td class="p-2 lg:p-3 text-center font-bold">${o.timesPerDay}</td><td class="p-2 lg:p-3 text-right font-mono font-bold">${(o.totalDays * o.timesPerDay).toLocaleString()}</td><td class="p-2 lg:p-3 text-right font-black">${(o.netTotal - o.vatAmount).toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>`;
                    itemsContainer.appendChild(row);
                });
            }
            const beforeVatEl = document.getElementById('quotation-before-vat');
            const vatEl = document.getElementById('quotation-vat');
            const totalEl = document.getElementById('quotation-total');
            if (beforeVatEl) beforeVatEl.textContent = `${beforeVat.toLocaleString(undefined, { minimumFractionDigits: 2 })} บาท`;
            if (vatEl) vatEl.textContent = `${vat.toLocaleString(undefined, { minimumFractionDigits: 2 })} บาท`;
            if (totalEl) totalEl.textContent = `${total.toLocaleString(undefined, { minimumFractionDigits: 2 })} บาท`;
            const preview = document.getElementById('quotation-preview');
            const empty = document.getElementById('quotation-empty');
            if (preview) preview.classList.remove('hidden');
            if (empty) empty.classList.add('hidden');
        }
        
        function printQuotation() {
            const customerId = document.getElementById('quotation-customer').value;
            if (!customerId) { showNotification('กรุณาเลือกลูกค้าก่อนพิมพ์', 'error'); return; }
            window.print();
        }
        
        function renderQuotations() { populateQuotationCustomerSelect(); }
        
        // ========== REPORT ==========
        function renderReport() {
            const customerCount = document.getElementById('report-customer-count');
            const productCount = document.getElementById('report-product-count');
            const packageCount = document.getElementById('report-package-count');
            if (customerCount) customerCount.textContent = systemData.customers.length;
            if (productCount) productCount.textContent = systemData.products.length;
            if (packageCount) packageCount.textContent = systemData.packages.length;
        }
        
        function printReport(type) {
            const printContainer = document.getElementById('print-report-container');
            if (!printContainer) return;
            let reportHtml = '';
            const today = new Date().toLocaleDateString('th-TH', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
            if (type === 'customer') {
                reportHtml = `<div class="print-report p-8 bg-white" style="font-family: 'Sarabun', sans-serif;"><div class="text-center mb-6"><h1 class="text-2xl font-bold text-blue-900">รายงานข้อมูลลูกค้า</h1><p class="text-sm">MCOT Radio Network Phitsanulok</p><p class="text-xs">วันที่พิมพ์: ${today}</p></div><div class="mb-4"><p class="font-bold">จำนวนลูกค้าทั้งหมด: ${systemData.customers.length} ราย</p></div><table class="w-full border-collapse border border-slate-300"><thead><tr class="bg-slate-200"><th class="border border-slate-300 p-2 text-left">ลำดับ</th><th class="border border-slate-300 p-2 text-left">ชื่อองค์กร</th><th class="border border-slate-300 p-2 text-left">ประเภท</th><th class="border border-slate-300 p-2 text-left">ผู้ติดต่อ</th><th class="border border-slate-300 p-2 text-left">เบอร์โทร</th><th class="border border-slate-300 p-2 text-left">อีเมล</th></tr></thead><tbody>${systemData.customers.map((c,i)=>`<tr><td class="border border-slate-300 p-2 text-center">${i+1}</td><td class="border border-slate-300 p-2">${escapeHtml(c.company)}</td><td class="border border-slate-300 p-2">${c.type}</td><td class="border border-slate-300 p-2">${escapeHtml(c.name)}</td><td class="border border-slate-300 p-2">${escapeHtml(c.phone)}</td><td class="border border-slate-300 p-2">${escapeHtml(c.email||'-')}</td></tr>`).join('')}</tbody></table></div>`;
            } else if (type === 'product') {
                const onAirCount = systemData.products.filter(p=>p.type==='onAir').length;
                const onlineCount = systemData.products.filter(p=>p.type==='online').length;
                const productionCount = systemData.products.filter(p=>p.type==='production').length;
                reportHtml = `<div class="print-report p-8 bg-white" style="font-family: 'Sarabun', sans-serif;"><div class="text-center mb-6"><h1 class="text-2xl font-bold text-blue-900">รายงานข้อมูลสินค้า</h1><p class="text-sm">MCOT Radio Network Phitsanulok</p><p class="text-xs">วันที่พิมพ์: ${today}</p></div><div class="mb-4 grid grid-cols-3 gap-4"><div class="bg-blue-50 p-3 rounded-lg text-center"><p class="font-bold">On Air</p><p class="text-2xl">${onAirCount}</p></div><div class="bg-emerald-50 p-3 rounded-lg text-center"><p class="font-bold">Online</p><p class="text-2xl">${onlineCount}</p></div><div class="bg-amber-50 p-3 rounded-lg text-center"><p class="font-bold">Production</p><p class="text-2xl">${productionCount}</p></div></div><table class="w-full border-collapse border border-slate-300"><thead><tr class="bg-slate-200"><th class="border border-slate-300 p-2 text-left">ลำดับ</th><th class="border border-slate-300 p-2 text-left">รหัสสินค้า</th><th class="border border-slate-300 p-2 text-left">ชื่อสินค้า</th><th class="border border-slate-300 p-2 text-left">ประเภท</th><th class="border border-slate-300 p-2 text-right">ราคา</th><th class="border border-slate-300 p-2 text-left">โปรโมชัน</th></tr></thead><tbody>${systemData.products.map((p,i)=>`<tr><td class="border border-slate-300 p-2 text-center">${i+1}</td><td class="border border-slate-300 p-2 font-mono">${escapeHtml(p.code)}</td><td class="border border-slate-300 p-2">${escapeHtml(p.name)}</td><td class="border border-slate-300 p-2">${p.type==='onAir'?'On Air':p.type==='online'?'Online':'Production'}</td><td class="border border-slate-300 p-2 text-right">${p.price.toLocaleString()} ฿</td><td class="border border-slate-300 p-2">${p.promotion==='มี'?escapeHtml(p.promotionDetail):'ไม่มี'}</td></tr>`).join('')}</tbody></table></div>`;
            } else if (type === 'package') {
                reportHtml = `<div class="print-report p-8 bg-white" style="font-family: 'Sarabun', sans-serif;"><div class="text-center mb-6"><h1 class="text-2xl font-bold text-blue-900">รายงานข้อมูลแพ็กเกจ</h1><p class="text-sm">MCOT Radio Network Phitsanulok</p><p class="text-xs">วันที่พิมพ์: ${today}</p></div><div class="mb-4"><p class="font-bold">จำนวนแพ็กเกจทั้งหมด: ${systemData.packages.length} แพ็กเกจ</p></div><table class="w-full border-collapse border border-slate-300"><thead><tr class="bg-slate-200"><th class="border border-slate-300 p-2 text-left">ลำดับ</th><th class="border border-slate-300 p-2 text-left">รหัสแพ็กเกจ</th><th class="border border-slate-300 p-2 text-left">ชื่อแพ็กเกจ</th><th class="border border-slate-300 p-2 text-center">จำนวนสินค้า</th><th class="border border-slate-300 p-2 text-right">ราคา</th><th class="border border-slate-300 p-2 text-right">ส่วนลด</th><th class="border border-slate-300 p-2 text-right">ราคาสุทธิ</th></tr></thead><tbody>${systemData.packages.map((p,i)=>{const totalProducts = p.products?.length||0; const discountAmount = p.price*(p.discount/100); const finalPrice = p.price - discountAmount; return `<tr><td class="border border-slate-300 p-2 text-center">${i+1}</td><td class="border border-slate-300 p-2 font-mono">${escapeHtml(p.code)}</td><td class="border border-slate-300 p-2">${escapeHtml(p.name)}</td><td class="border border-slate-300 p-2 text-center">${totalProducts}</td><td class="border border-slate-300 p-2 text-right">${p.price.toLocaleString()} ฿</td><td class="border border-slate-300 p-2 text-right">${p.discount>0?p.discount+'% ('+discountAmount.toLocaleString()+' ฿)':'-'}</td><td class="border border-slate-300 p-2 text-right font-bold">${finalPrice.toLocaleString()} ฿</td></tr>`}).join('')}</tbody></table></div>`;
            }
            printContainer.innerHTML = reportHtml;
            printContainer.classList.add('print-active');
            window.print();
            printContainer.classList.remove('print-active');
            printContainer.innerHTML = '';
        }
        
        // ========== UTILITY ==========
        function setupEventListeners() {
            const addCustomerForm = document.getElementById('add-customer-form');
            if (addCustomerForm) addCustomerForm.addEventListener('submit', addCustomer);
            const customerSearch = document.getElementById('customer-search');
            if (customerSearch) customerSearch.addEventListener('input', renderCustomers);
            const addProductForm = document.getElementById('add-product-form');
            if (addProductForm) addProductForm.addEventListener('submit', addProduct);
            const productSearch = document.getElementById('product-search');
            if (productSearch) productSearch.addEventListener('input', renderProducts);
            const addPackageForm = document.getElementById('add-package-form');
            if (addPackageForm) addPackageForm.addEventListener('submit', addPackage);
            const packageSearch = document.getElementById('package-search');
            if (packageSearch) packageSearch.addEventListener('input', renderPackages);
            const productPromotion = document.getElementById('product-promotion');
            if (productPromotion) {
                productPromotion.addEventListener('change', function() {
                    const container = document.getElementById('promotion-detail-container');
                    if (container) container.classList.toggle('hidden', this.value !== 'มี');
                });
            }
            const quotationCustomer = document.getElementById('quotation-customer');
            if (quotationCustomer) quotationCustomer.addEventListener('change', loadCustomerQuotation);
            const staffName = document.getElementById('staff-name');
            if (staffName) staffName.addEventListener('input', loadCustomerQuotation);
            const staffPhone = document.getElementById('staff-phone');
            if (staffPhone) staffPhone.addEventListener('input', loadCustomerQuotation);
            window.addEventListener('click', function(e) {
                const modal = document.getElementById('package-detail-modal');
                if (e.target === modal) closePackageModal();
            });
        }
        
        function renderAll() {
            renderCustomers();
            renderProducts();
            renderPackages();
            renderQuotations();
            renderReport();
            updateOrdersTable();
            updateCampaignTotal();
        }
        
        function updateBadges() {
            const customerBadge = document.getElementById('customer-badge');
            if (customerBadge) { customerBadge.textContent = systemData.customers.length; customerBadge.classList.toggle('hidden', systemData.customers.length === 0); }
            const orderBadge = document.getElementById('order-badge');
            if (orderBadge) { orderBadge.textContent = systemData.orders.length; orderBadge.classList.toggle('hidden', systemData.orders.length === 0); }
        }
        
        function updateLastSaved() {
            const el = document.getElementById('last-saved');
            if (el) {
                if (systemData.settings.lastSave) {
                    const d = new Date(systemData.settings.lastSave);
                    el.textContent = `${d.toLocaleDateString('th-TH')} ${d.toLocaleTimeString('th-TH')}`;
                } else el.textContent = 'ยังไม่เคยบันทึก';
            }
        }
        
        function formatDate(d) { return new Date(d).toLocaleDateString('th-TH'); }
        function escapeHtml(u) { if (!u) return ''; return u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"); }
        function showNotification(m,t) {
            const old = document.querySelector('.notification');
            if (old) old.remove();
            const n = document.createElement('div');
            n.className = `notification fixed top-4 right-4 px-4 lg:px-6 py-2 lg:py-3 rounded-lg shadow-lg text-white font-medium z-50 animate-fadeIn ${t==='success'?'bg-emerald-500':t==='error'?'bg-red-500':'bg-blue-500'}`;
            n.textContent = m;
            document.body.appendChild(n);
            setTimeout(()=>{ n.style.opacity='0'; n.style.transition='opacity 0.3s'; setTimeout(()=>n.remove(),300); },3000);
        }
    </script>
</body>
</html>
