<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MCOT Phitsanulok Package Manager</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2721/2721264.png" type="image/png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Prompt', sans-serif;
        }
        
        .mcot-gradient {
            background: linear-gradient(135deg, #0d3b66 0%, #1c5bb8 100%);
        }
        
        .gold-border {
            border-color: #f9a826;
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white !important;
                font-size: 12pt;
            }
            
            .print-only {
                display: block !important;
            }
            
            #quotation-preview {
                display: block !important;
                border: none !important;
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
                max-width: 100% !important;
            }
            
            .page-break {
                page-break-before: always;
            }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .time-slot-btn {
            transition: all 0.2s;
        }
        
        .time-slot-btn.selected {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }
        
        .weekday-btn {
            transition: all 0.2s;
        }
        
        .weekday-btn.selected {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .order-type-btn.active {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            color: #2563eb;
        }
        
        .duration-mode-btn.active {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            color: #2563eb;
        }
        
        /* ===== RESPONSIVE FIXES FOR MOBILE ===== */
        @media (max-width: 768px) {
            /* ซ่อน Sidebar เดิมในมือถือ */
            .fixed.left-0 {
                position: fixed;
                top: 0;
                left: -100%;
                width: 85%;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                overflow-y: auto;
            }
            
            .fixed.left-0.active {
                left: 0;
                box-shadow: 4px 0 20px rgba(0,0,0,0.3);
            }
            
            /* Main content สำหรับมือถือ */
            main {
                margin-left: 0 !important;
                padding: 1rem !important;
                width: 100%;
                min-height: calc(100vh - 60px);
                padding-bottom: 80px !important; /* เว้นที่สำหรับ mobile menu */
            }
            
            /* Mobile Menu Button */
            .mobile-menu-toggle {
                display: flex !important;
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1001;
                background: #0d3b66;
                color: white;
                width: 56px;
                height: 56px;
                border-radius: 50%;
                align-items: center;
                justify-content: center;
                font-size: 22px;
                box-shadow: 0 4px 15px rgba(13, 59, 102, 0.4);
                border: 2px solid white;
            }
            
            .mobile-menu-toggle.menu-open {
                background: #f9a826;
            }
            
            /* Mobile Overlay */
            .mobile-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }
            
            .mobile-overlay.active {
                display: block;
            }
            
            /* ปรับ Header */
            header.mb-10 {
                margin-bottom: 2rem !important;
            }
            
            h1.text-4xl {
                font-size: 1.8rem !important;
                line-height: 1.2;
            }
            
            /* ปรับ Padding */
            .p-8, .p-12 {
                padding: 1.5rem !important;
            }
            
            .p-6 {
                padding: 1.25rem !important;
            }
            
            /* ปรับ Grid Layouts */
            .grid-cols-1, 
            .grid-cols-2, 
            .grid-cols-3, 
            .grid-cols-4,
            .xl\:grid-cols-3,
            .md\:grid-cols-2,
            .md\:grid-cols-3 {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* ปรับ Orders Tab */
            #time-slots-container.grid-cols-4 {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.5rem;
            }
            
            .time-slot-btn {
                font-size: 10px !important;
                padding: 8px 4px !important;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                line-height: 1.2;
            }
            
            /* Weekday Buttons */
            .weekday-btn {
                width: 40px !important;
                height: 40px !important;
                font-size: 13px;
            }
            
            /* ปุ่มใน Sidebar */
            .tab-btn {
                padding: 14px 20px !important;
                font-size: 14px;
                border-left-width: 3px;
            }
            
            .tab-btn i {
                width: 22px !important;
                font-size: 16px;
            }
            
            /* ปรับ Tables */
            .overflow-x-auto {
                font-size: 13px;
            }
            
            table {
                display: block;
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            th, td {
                padding: 12px 16px !important;
                min-width: 120px;
            }
            
            /* ปรับ Form Elements */
            input, select, textarea {
                font-size: 16px !important; /* ป้องกัน zoom ใน iOS */
                padding: 14px 16px !important;
                border-radius: 12px !important;
            }
            
            /* ปรับ Buttons */
            button:not(.mobile-menu-toggle) {
                padding: 14px 20px !important;
                font-size: 15px;
                border-radius: 12px;
            }
            
            /* ปรับ Cards */
            .rounded-2xl {
                border-radius: 16px !important;
            }
            
            /* Hide desktop elements */
            .desktop-only {
                display: none !important;
            }
            
            /* Show mobile elements */
            .mobile-only {
                display: block !important;
            }
            
            /* ปรับ Badges */
            #customer-badge, #order-badge {
                font-size: 10px;
                padding: 2px 6px;
            }
        }
        
        /* สำหรับหน้าจอขนาดกลาง */
        @media (min-width: 769px) and (max-width: 1024px) {
            main {
                margin-left: 64px !important;
                padding: 2rem !important;
            }
            
            .grid-cols-2 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            .xl\:grid-cols-3 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
        
        /* ปรับปรุงสำหรับ Desktop */
        @media (min-width: 1025px) {
            .mobile-menu-toggle,
            .mobile-overlay {
                display: none !important;
            }
            
            .fixed.left-0 {
                left: 0 !important;
            }
        }
        
        /* ปรับปรุง Scroll ในมือถือ */
        @media (max-width: 768px) {
            body {
                -webkit-tap-highlight-color: transparent;
            }
            
            /* ปรับปรุงการ scroll ใน iOS */
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* สไตล์สำหรับประเภทสินค้า */
        .product-type-onair {
            border-left: 4px solid #3b82f6;
        }
        
        .product-type-online {
            border-left: 4px solid #10b981;
        }
        
        .product-type-production {
            border-left: 4px solid #f59e0b;
        }
        
        /* สไตล์สำหรับแพ็กเกจ */
        .package-card {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
        }
        
        /* สไตล์สำหรับใบเสนอราคา */
        .quotation-table th {
            background-color: #e5e7eb;
            font-weight: bold;
            text-align: center;
            padding: 8px;
            border: 1px solid #d1d5db;
        }
        
        .quotation-table td {
            padding: 8px;
            border: 1px solid #d1d5db;
        }
        
        .payment-details {
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-top: 20px;
        }
        
        .discount-details {
            background-color: #f0fdf4;
            border-left: 4px solid #10b981;
            padding: 15px;
            margin-top: 10px;
        }
        
        .coverage-details {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="mobile-overlay no-print" onclick="closeMobileMenu()"></div>
    
    <!-- Navigation Sidebar -->
    <div class="fixed left-0 top-0 h-screen w-64 mcot-gradient text-white z-50 no-print">
        <div class="p-6 flex flex-col items-center border-b border-white/10">
            <div class="bg-white p-3 rounded-2xl mb-4 shadow-xl">
                <i class="fas fa-broadcast-tower text-[#1c5bb8] text-4xl"></i>
            </div>
            <h1 class="text-lg font-bold text-center leading-tight">MCOT Package</h1>
            <p class="text-xs opacity-70 mt-1">FM 106.25 Phitsanulok</p>
            <button onclick="closeMobileMenu()" class="absolute top-4 right-4 text-white text-xl mobile-only">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <nav class="flex-1 py-4 overflow-y-auto">
            <button onclick="switchTab('customers'); closeMobileMenu();" class="tab-btn w-full flex items-center px-6 py-3 transition-colors relative group border-l-4" data-tab="customers">
                <i class="fas fa-users w-5 text-center"></i>
                <span class="ml-4 text-sm font-medium">ลูกค้า</span>
                <span id="customer-badge" class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold hidden">0</span>
            </button>
            
            <button onclick="switchTab('products'); closeMobileMenu();" class="tab-btn w-full flex items-center px-6 py-3 transition-colors relative group border-l-4" data-tab="products">
                <i class="fas fa-box w-5 text-center"></i>
                <span class="ml-4 text-sm font-medium">สินค้า</span>
            </button>
            
            <button onclick="switchTab('packages'); closeMobileMenu();" class="tab-btn w-full flex items-center px-6 py-3 transition-colors relative group border-l-4" data-tab="packages">
                <i class="fas fa-boxes w-5 text-center"></i>
                <span class="ml-4 text-sm font-medium">แพ็กเกจ</span>
            </button>
            
            <button onclick="switchTab('orders'); closeMobileMenu();" class="tab-btn w-full flex items-center px-6 py-3 transition-colors relative group border-l-4" data-tab="orders">
                <i class="fas fa-shopping-cart w-5 text-center"></i>
                <span class="ml-4 text-sm font-medium">รายการสั่งซื้อ</span>
                <span id="order-badge" class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold hidden">0</span>
            </button>
            
            <button onclick="switchTab('quotations'); closeMobileMenu();" class="tab-btn w-full flex items-center px-6 py-3 transition-colors relative group border-l-4" data-tab="quotations">
                <i class="fas fa-file-invoice-dollar w-5 text-center"></i>
                <span class="ml-4 text-sm font-medium">ใบเสนอราคา</span>
            </button>
        </nav>
        
        <div class="p-4 border-t border-white/10 space-y-2 bg-black/10">
            <p class="text-[10px] font-bold text-white/40 uppercase tracking-widest mb-1 px-1">คำสั่งหลัก</p>
            <button onclick="saveData()" class="w-full flex items-center justify-center gap-2 bg-emerald-500 hover:bg-emerald-600 text-white py-2 rounded-lg text-sm font-semibold shadow-md transition-all active:scale-95">
                <i class="fas fa-save"></i> บันทึก
            </button>
            
            <div class="grid grid-cols-2 gap-2">
                <button onclick="exportData()" class="flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-400 text-white py-2 rounded-lg text-xs font-semibold shadow-md transition-all active:scale-95">
                    <i class="fas fa-download"></i> ส่งออก
                </button>
                <button onclick="document.getElementById('import-file').click()" class="flex items-center justify-center gap-2 bg-indigo-500 hover:bg-indigo-400 text-white py-2 rounded-lg text-xs font-semibold shadow-md transition-all active:scale-95">
                    <i class="fas fa-upload"></i> นำเข้า
                </button>
                <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(event)">
            </div>
            
            <button onclick="clearData()" class="w-full flex items-center justify-center gap-2 bg-rose-600 hover:bg-rose-700 text-white py-2 rounded-lg text-xs font-semibold shadow-md transition-all active:scale-95">
                <i class="fas fa-trash"></i> ล้างข้อมูลทั้งหมด
            </button>
            
            <div class="pt-2">
                <p class="text-[10px] text-center text-white/50 font-medium leading-relaxed">
                    By Suraphun Inopas@2026 V4.0
                </p>
            </div>
        </div>
    </div>
    
    <!-- Mobile Menu Button -->
    <button id="mobileMenuToggle" class="mobile-menu-toggle hidden no-print">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Main Content -->
    <main class="ml-64 p-8 lg:p-12 transition-all min-h-screen">
        <header class="mb-10 no-print">
            <div class="flex justify-between items-end">
                <div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">MCOT Phitsanulok FM 106.25</p>
                    <h1 id="page-title" class="text-4xl font-black text-slate-900 tracking-tight capitalize">ระบบจัดการแพ็กเกจ</h1>
                </div>
                <div class="text-[10px] text-slate-400 font-mono text-right italic desktop-only">
                    Last saved: <span id="last-saved">ไม่เคยบันทึก</span>
                </div>
                <!-- Mobile Save Status -->
                <div class="mobile-only text-xs text-slate-500">
                    <span id="mobile-last-saved">ไม่เคยบันทึก</span>
                </div>
            </div>
        </header>
        
        <!-- Customers Tab -->
        <div id="customers-tab" class="tab-content animate-fadeIn hidden">
            <!-- ... (โค้ดเดิมหน้า customers) ... -->
        </div>
        
        <!-- Products Tab -->
        <div id="products-tab" class="tab-content animate-fadeIn hidden">
            <!-- ... (โค้ดเดิมหน้า products) ... -->
        </div>
        
        <!-- Packages Tab -->
        <div id="packages-tab" class="tab-content animate-fadeIn hidden">
            <!-- ... (โค้ดเดิมหน้า packages) ... -->
        </div>
        
        <!-- Orders Tab -->
        <div id="orders-tab" class="tab-content animate-fadeIn hidden">
            <!-- ... (โค้ดเดิมหน้า orders) ... -->
        </div>
        
        <!-- Quotations Tab - UPDATED VERSION -->
        <div id="quotations-tab" class="tab-content animate-fadeIn hidden">
            <div class="space-y-8">
                <!-- Configuration -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden no-print">
                    <div class="p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-file-invoice-dollar text-blue-600 text-xl"></i>
                            <h2 class="text-xl font-bold">ตั้งค่าการออกเอกสาร</h2>
                        </div>
                        <button onclick="printQuotation()" id="print-quotation-btn" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl text-sm font-bold shadow-lg transition-all active:scale-95">
                            <i class="fas fa-print"></i> พิมพ์ใบเสนอราคา
                        </button>
                    </div>
                    <div class="p-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">เลือกลูกค้า</label>
                            <select id="quotation-customer" class="w-full px-4 py-2.5 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                                <option value="">-- เลือกลูกค้า --</option>
                            </select>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">ชื่อผู้เสนอราคา</label>
                            <input type="text" id="staff-name" value="ฝ่ายขาย" class="w-full px-4 py-2.5 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-sm font-semibold text-slate-700">เบอร์ติดต่อผู้ขาย</label>
                            <input type="text" id="staff-phone" value="055-287833" class="w-full px-4 py-2.5 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-100">
                        </div>
                    </div>
                </div>
                
                <!-- Quotation Preview - UPDATED -->
                <div id="quotation-preview" class="bg-white p-8 lg:p-12 shadow-2xl rounded-sm border border-slate-200 max-w-5xl mx-auto text-slate-800 min-h-[1100px] flex flex-col font-['Sarabun'] hidden print:block print:shadow-none print:border-none print:max-w-full">
                    <!-- Header -->
                    <div class="flex flex-col items-center text-center border-b-4 border-slate-800 pb-6 mb-8">
                        <h1 class="text-2xl font-black text-blue-900 mb-1">MCOT Radio Network Phitsanulok</h1>
                        <p class="text-lg font-bold">สถานีวิทยุกระจายเสียง อสมท จังหวัดพิษณุโลก F.M. 106.25 MHz.</p>
                        <p class="text-sm">บมจ.อสมท สาขาพิษณุโลก 1 สาขาที่ 00010</p>
                        <p class="text-sm">361/4 หมู่ที่ 2 ถนนบึงพระ-วัดหล่ม ต.บึงพระ อ.เมือง จ.พิษณุโลก 65000</p>
                        <p class="text-sm font-bold mt-1">โทร. 055-287833 | เลขประจำตัวผู้เสียภาษี 0107547000745</p>
                    </div>
                    
                    <!-- Customer Info -->
                    <div class="grid grid-cols-2 gap-8 mb-8 text-sm">
                        <div class="space-y-1.5">
                            <div class="flex">
                                <span class="font-bold w-20">เรียน:</span>
                                <span id="quotation-company" class="font-black border-b border-dotted border-slate-400 flex-1"></span>
                            </div>
                            <div class="flex">
                                <span class="font-bold w-20">ที่อยู่:</span>
                                <span id="quotation-address" class="border-b border-dotted border-slate-400 flex-1"></span>
                            </div>
                            <div class="flex">
                                <span class="font-bold w-20">เบอร์โทรศัพท์:</span>
                                <span id="quotation-phone" class="border-b border-dotted border-slate-400 flex-1"></span>
                            </div>
                        </div>
                        <div class="space-y-1.5 flex flex-col items-end">
                            <div class="flex w-full justify-end">
                                <span class="font-bold mr-2">วันที่:</span>
                                <span class="font-bold border-b border-dotted border-slate-400 w-40 text-center">
                                    <span id="quotation-date"></span>
                                </span>
                            </div>
                            <div class="flex w-full justify-end mt-4">
                                <span class="font-bold mr-2">เลขที่ใบเสนอราคา:</span>
                                <span class="font-bold border-b border-dotted border-slate-400 w-40 text-center">
                                    <span id="quotation-number">Q-${new Date().getFullYear()}${(new Date().getMonth()+1).toString().padStart(2,'0')}-001</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Table -->
                    <div class="flex-1 overflow-hidden">
                        <table class="w-full text-xs border-collapse quotation-table">
                            <thead>
                                <tr class="bg-slate-200">
                                    <th class="p-2 text-center border border-slate-300 w-12">ลำดับ</th>
                                    <th class="p-2 text-left border border-slate-300">รายละเอียดสินค้า/บริการ</th>
                                    <th class="p-2 text-center border border-slate-300 w-20">จำนวนวัน</th>
                                    <th class="p-2 text-center border border-slate-300 w-20">ครั้ง/วัน</th>
                                    <th class="p-2 text-right border border-slate-300 w-28">ครั้งรวม</th>
                                    <th class="p-2 text-right border border-slate-300 w-32">ราคา/ครั้ง</th>
                                    <th class="p-2 text-right border border-slate-300 w-32">ยอดสุทธิ (บาท)</th>
                                </tr>
                            </thead>
                            <tbody id="quotation-items">
                                <!-- Items will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Discount Details -->
                    <div id="quotation-discount-details" class="discount-details mt-4 hidden">
                        <!-- Discount details will be inserted here -->
                    </div>
                    
                    <!-- Financial Summary -->
                    <div class="mt-8 flex justify-end">
                        <div class="w-80 space-y-1">
                            <div class="flex justify-between text-sm py-1 border-b border-slate-100">
                                <span class="font-bold">ยอดก่อน VAT รวม:</span>
                                <span id="quotation-before-vat" class="font-black">0 บาท</span>
                            </div>
                            <div class="flex justify-between text-sm py-1 border-b border-slate-100">
                                <span class="font-bold">VAT 7% รวม:</span>
                                <span id="quotation-vat" class="font-black">0 บาท</span>
                            </div>
                            <div class="flex justify-between items-center bg-slate-800 text-white p-3 rounded-lg mt-2 shadow-md">
                                <span class="text-sm font-black">ยอดสุทธิรวม:</span>
                                <span id="quotation-total" class="text-xl font-black">0 บาท</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Coverage Details -->
                    <div class="coverage-details mt-6">
                        <p class="font-bold text-amber-800 mb-2">*** รัศมีการออกอากาศ:</p>
                        <p class="text-sm pl-4">ครอบคลุมจังหวัดพิษณุโลก และเขตติดต่อจังหวัดใกล้เคียงบางส่วน เช่น จังหวัดพิจิตร, สุโขทัย, อุตรดิตถ์ และเพชรบูรณ์</p>
                        
                        <p class="font-bold text-amber-800 mt-4 mb-2">*** เงื่อนไข:</p>
                        <ul class="text-sm pl-6 list-disc">
                            <li>ลูกค้ารายใหม่ชำระเงินก่อนออกอากาศ ในเวลาทำการ 09.00 น. – 15.00 น. (วันจันทร์ – วันศุกร์)</li>
                            <li>ถ้าชำระหลังเวลา 15.00 น. ถือว่าชำระในวันรุ่งขึ้น</li>
                        </ul>
                    </div>
                    
                    <!-- Payment Details -->
                    <div class="payment-details mt-6">
                        <p class="font-bold text-blue-800 mb-2">*** รายละเอียดการชำระเงิน:</p>
                        <ul class="text-sm pl-6 list-disc">
                            <li><strong>ชำระเป็นเช็ค:</strong> สั่งจ่ายในนาม บมจ.อสมท</li>
                            <li><strong>โอนเงินเข้าบัญชี:</strong> บมจ. อสมท บัญชีเลขที่ 015-1-05842-3 ธนาคารกรุงไทย สาขาสิงห์คอมเพล็กซ์</li>
                            <li><strong>ชำระเป็นเงินสด:</strong> ที่ฝ่ายการเงิน บมจ. อสมท สาขาพิษณุโลก 1 ในเวลาทำการ 09.00 น. – 15.00 น.</li>
                            <li><strong>หนังสือรับรองการหักภาษี ณ ที่จ่าย ออกในนาม:</strong><br>
                                บมจ.อสมท 63/1 ถ.พระราม 9 แขวงห้วยขวาง เขตห้วยขวาง กรุงเทพฯ 10310<br>
                                เลขประจำตัวผู้เสียภาษี 0107547000745
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Proposer Signature -->
                    <div class="mt-12 mb-8 flex justify-end">
                        <div class="text-center w-64 space-y-12">
                            <div class="border-b border-slate-300 pb-1">
                                <p class="text-sm font-bold text-slate-800">ผู้เสนอราคา: <span id="quotation-staff-name">ฝ่ายขาย</span></p>
                                <p class="text-xs text-slate-500">โทร: <span id="quotation-staff-phone">055-287833</span></p>
                            </div>
                            <div class="space-y-1">
                                <p class="text-xs">(....................................................................)</p>
                                <p class="text-xs font-bold text-slate-500">MCOT Radio Network Phitsanulok</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer Notes -->
                    <div class="mt-8 text-xs text-slate-500 text-center border-t border-slate-200 pt-4">
                        <p>ใบเสนอราคานี้มีอายุ 30 วัน นับจากวันที่ออกใบเสนอราคา</p>
                        <p>เงื่อนไขการชำระเงินเป็นไปตามที่ระบุในสัญญา</p>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div id="quotation-empty" class="bg-white rounded-2xl p-24 text-center text-slate-400 border border-slate-200 shadow-sm flex flex-col items-center gap-4">
                    <i class="fas fa-file-invoice-dollar text-6xl opacity-10"></i>
                    <p class="text-lg font-medium">กรุณาเลือกลูกค้าเพื่อแสดงตัวอย่างใบเสนอราคา</p>
                    <p class="text-sm">ใบเสนอราคาจะถูกสร้างขึ้นอัตโนมัติตามรายการที่เลือก</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ========== DATA STORAGE ==========
        let systemData = {
            customers: [],
            products: [],
            packages: [],
            orders: [],
            settings: {
                lastSave: null,
                version: "4.0"
            }
        };
        
        // ========== CONSTANTS ==========
        const TIME_SLOTS = [
            { period: 'ช่วงเช้า (08:00-10:00)', slots: ['08:00-08:30', '08:30-09:00', '09:00-09:30', '09:30-10:00'] },
            { period: 'ช่วงสาย (10:00-12:00)', slots: ['10:00-10:30', '10:30-11:00', '11:00-11:30', '11:30-12:00'] },
            { period: 'ช่วงเที่ยง (12:00-14:00)', slots: ['12:00-12:30', '12:30-13:00', '13:00-13:30', '13:30-14:00'] },
            { period: 'ช่วงบ่าย (14:00-16:00)', slots: ['14:00-14:30', '14:30-15:00', '15:00-15:30', '15:30-16:00'] },
            { period: 'ช่วงเย็น (16:00-18:00)', slots: ['16:00-16:30', '16:30-17:00', '17:00-17:30', '17:30-18:00'] }
        ];
        
        const WEEKDAYS = [
            { label: 'อา', value: 0 },
            { label: 'จ', value: 1 },
            { label: 'อ', value: 2 },
            { label: 'พ', value: 3 },
            { label: 'พฤ', value: 4 },
            { label: 'ศ', value: 5 },
            { label: 'ส', value: 6 }
        ];
        
        // ========== ORDER SECTION STATE ==========
        let currentOrder = {
            selectedCustomerId: '',
            orderType: 'Produce',
            selectedItemId: '',
            startDate: new Date().toISOString().split('T')[0],
            endDate: '',
            selectedDays: [1, 2, 3, 4, 5], // Mon-Fri
            selectedSlots: [],
            paymentType: 'หลังออกอากาศ',
            note: ''
        };
        
        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
            switchTab('customers');
            updateBadges();
            setupMobileMenu();
            
            // Auto-save every 30 seconds
            setInterval(saveData, 30000);
            
            // Initialize orders tab
            initializeOrdersTab();
            
            // Update mobile save status
            updateMobileLastSaved();
        });
        
        // ========== MOBILE MENU FUNCTIONS ==========
        function setupMobileMenu() {
            const mobileToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.querySelector('.fixed.left-0');
            const overlay = document.getElementById('mobileOverlay');
            
            if (mobileToggle && sidebar && overlay) {
                // Show/hide toggle button based on screen size
                function updateMobileMenuVisibility() {
                    if (window.innerWidth <= 768) {
                        mobileToggle.classList.remove('hidden');
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                        mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                        mobileToggle.classList.remove('menu-open');
                    } else {
                        mobileToggle.classList.add('hidden');
                        sidebar.classList.add('active');
                        overlay.classList.remove('active');
                    }
                }
                
                // Toggle menu
                mobileToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    sidebar.classList.toggle('active');
                    overlay.classList.toggle('active');
                    mobileToggle.classList.toggle('menu-open');
                    mobileToggle.innerHTML = sidebar.classList.contains('active') 
                        ? '<i class="fas fa-times"></i>' 
                        : '<i class="fas fa-bars"></i>';
                });
                
                // Close menu when clicking overlay
                overlay.addEventListener('click', closeMobileMenu);
                
                // Close menu when clicking outside on mobile
                document.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768 && 
                        sidebar.classList.contains('active') &&
                        !sidebar.contains(e.target) &&
                        !mobileToggle.contains(e.target)) {
                        closeMobileMenu();
                    }
                });
                
                // Initial setup
                updateMobileMenuVisibility();
                
                // Update on resize
                window.addEventListener('resize', updateMobileMenuVisibility);
            }
        }
        
        function closeMobileMenu() {
            const sidebar = document.querySelector('.fixed.left-0');
            const overlay = document.getElementById('mobileOverlay');
            const mobileToggle = document.getElementById('mobileMenuToggle');
            
            if (sidebar) sidebar.classList.remove('active');
            if (overlay) overlay.classList.remove('active');
            if (mobileToggle) {
                mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                mobileToggle.classList.remove('menu-open');
            }
        }
        
        // ========== DATA MANAGEMENT ==========
        function loadData() {
            const saved = localStorage.getItem('mcot_package_v4_data');
            if (saved) {
                try {
                    systemData = JSON.parse(saved);
                    updateLastSaved();
                    updateMobileLastSaved();
                    renderAll();
                } catch (e) {
                    console.error("Error loading data:", e);
                    showNotification("เกิดข้อผิดพลาดในการโหลดข้อมูล", 'error');
                }
            } else {
                // Add sample data for testing
                addSampleData();
            }
        }
        
        function addSampleData() {
            // Sample customers
            systemData.customers = [
                {
                    id: 'CUST-1',
                    company: 'บริษัท เอเบซี จำกัด',
                    type: 'เอกชน',
                    category: 'อาหาร',
                    address: '123 ถนนสุขุมวิท กรุงเทพฯ',
                    name: 'คุณสมชาย ใจดี',
                    position: 'ผู้จัดการ',
                    phone: '081-2345678',
                    email: 'somchai@abc.com',
                    potential: 'กลาง',
                    note: 'ลูกค้าประจำ',
                    created: new Date().toISOString()
                }
            ];
            
            // Sample products
            systemData.products = [
                {
                    id: 'PROD-1',
                    code: 'OA-001',
                    type: 'onAir',
                    name: 'โฆษณาเสียง 30 วินาที',
                    price: 1500,
                    promotion: 'ไม่มี',
                    note: 'ออกอากาศช่วงเวลาใดก็ได้',
                    created: new Date().toISOString()
                },
                {
                    id: 'PROD-2',
                    code: 'OA-002',
                    type: 'onAir',
                    name: 'โฆษณาเสียง 60 วินาที',
                    price: 2500,
                    promotion: 'มี',
                    promotionDetail: 'ซื้อ 10 ครั้ง แถม 1 ครั้ง',
                    note: 'ออกอากาศช่วงเวลาใดก็ได้',
                    created: new Date().toISOString()
                }
            ];
            
            systemData.packages = [];
            systemData.orders = [];
            
            saveData();
            renderAll();
        }
        
        function saveData() {
            systemData.settings.lastSave = new Date().toISOString();
            localStorage.setItem('mcot_package_v4_data', JSON.stringify(systemData));
            updateLastSaved();
            updateMobileLastSaved();
            updateBadges();
            showNotification('บันทึกข้อมูลเรียบร้อยแล้ว', 'success');
        }
        
        function exportData() {
            const dataStr = JSON.stringify(systemData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `MCOT_Backup_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('ส่งออกข้อมูลสำเร็จ', 'success');
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (confirm("คุณแน่ใจหรือไม่ว่าต้องการนำเข้าข้อมูล? ข้อมูลปัจจุบันจะถูกเขียนทับ")) {
                        systemData = importedData;
                        saveData();
                        renderAll();
                        showNotification('นำเข้าข้อมูลสำเร็จ', 'success');
                    }
                } catch (err) {
                    showNotification('ไม่สามารถนำเข้าข้อมูลได้: ไฟล์ไม่ถูกต้อง', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
        
        function clearData() {
            if (confirm("ต้องการล้างข้อมูลทั้งหมดหรือไม่? การกระทำนี้ไม่สามารถย้อนกลับได้")) {
                localStorage.removeItem('mcot_package_v4_data');
                systemData = {
                    customers: [],
                    products: [],
                    packages: [],
                    orders: [],
                    settings: {
                        lastSave: null,
                        version: "4.0"
                    }
                };
                renderAll();
                showNotification('ล้างข้อมูลเรียบร้อยแล้ว', 'success');
            }
        }
        
        // ========== TAB MANAGEMENT ==========
        function switchTab(tabName) {
            // Close mobile menu if open
            closeMobileMenu();
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-[#f9a826]', 'bg-white/15');
                btn.classList.add('border-transparent');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            
            // Activate selected button
            const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('border-[#f9a826]', 'bg-white/15');
                activeBtn.classList.remove('border-transparent');
            }
            
            // Update page title
            const pageTitle = document.getElementById('page-title');
            if (pageTitle) {
                pageTitle.textContent = getTabTitle(tabName);
            }
            
            // Render specific content if needed
            if (tabName === 'customers') renderCustomers();
            if (tabName === 'products') renderProducts();
            if (tabName === 'orders') {
                setTimeout(() => {
                    initializeOrdersTab();
                }, 100);
            }
            if (tabName === 'quotations') {
                setTimeout(() => {
                    populateQuotationCustomerSelect();
                }, 100);
            }
        }
        
        function getTabTitle(tabName) {
            const titles = {
                'customers': 'ลูกค้า',
                'products': 'สินค้า',
                'packages': 'แพ็กเกจ',
                'orders': 'รายการสั่งซื้อ',
                'quotations': 'ใบเสนอราคา'
            };
            return titles[tabName] || 'ระบบจัดการแพ็กเกจ';
        }
        
        // ========== QUOTATION MANAGEMENT - UPDATED ==========
        function populateQuotationCustomerSelect() {
            const select = document.getElementById('quotation-customer');
            if (!select) return;
            
            select.innerHTML = '<option value="">-- เลือกลูกค้า --</option>';
            
            systemData.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.company;
                select.appendChild(option);
            });
            
            // Add change event listener
            select.addEventListener('change', loadCustomerQuotation);
        }
        
        function loadCustomerQuotation() {
            const customerId = document.getElementById('quotation-customer').value;
            
            if (!customerId) {
                document.getElementById('quotation-preview').classList.add('hidden');
                document.getElementById('quotation-empty').classList.remove('hidden');
                return;
            }
            
            const customer = systemData.customers.find(c => c.id === customerId);
            const customerOrders = systemData.orders.filter(o => o.customerId === customerId);
            
            if (!customer || customerOrders.length === 0) {
                document.getElementById('quotation-preview').classList.add('hidden');
                document.getElementById('quotation-empty').classList.remove('hidden');
                return;
            }
            
            // Calculate totals and discount details
            let beforeVat = 0;
            let vat = 0;
            let total = 0;
            let totalConditionDiscount = 0;
            let totalPaymentDiscount = 0;
            let hasDiscount = false;
            
            // Update customer info
            document.getElementById('quotation-company').textContent = customer.company;
            document.getElementById('quotation-address').textContent = customer.address || '-';
            document.getElementById('quotation-phone').textContent = customer.phone || '-';
            document.getElementById('quotation-date').textContent = new Date().toLocaleDateString('th-TH', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            document.getElementById('quotation-staff-name').textContent = document.getElementById('staff-name').value;
            document.getElementById('quotation-staff-phone').textContent = document.getElementById('staff-phone').value;
            
            // Generate quotation number
            const today = new Date();
            const quotationNumber = `Q-${today.getFullYear()}${(today.getMonth()+1).toString().padStart(2,'0')}${today.getDate().toString().padStart(2,'0')}-${customerOrders.length.toString().padStart(3,'0')}`;
            document.getElementById('quotation-number').textContent = quotationNumber;
            
            // Update items with serial numbers
            const itemsContainer = document.getElementById('quotation-items');
            itemsContainer.innerHTML = '';
            
            customerOrders.forEach((order, index) => {
                const unitPrice = order.unitPrice || 0;
                const totalTimes = order.totalDays * order.timesPerDay;
                const orderTotal = order.netTotal - order.vatAmount;
                
                beforeVat += orderTotal;
                vat += order.vatAmount;
                total += order.netTotal;
                totalConditionDiscount += (order.totalPrice * order.conditionDiscountPercent / 100);
                totalPaymentDiscount += (order.totalPrice - (order.totalPrice * order.conditionDiscountPercent / 100)) * (order.paymentDiscountPercent / 100);
                
                if (order.conditionDiscountPercent > 0 || order.paymentDiscountPercent > 0) {
                    hasDiscount = true;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="p-2 text-center border border-slate-300">${index + 1}</td>
                    <td class="p-2 text-left border border-slate-300">
                        <p class="font-bold">${order.productName}</p>
                        ${order.note ? `<p class="text-[10px] text-blue-600 mt-0.5">* ${order.note}</p>` : ''}
                        <p class="text-[10px] text-slate-500 mt-1">
                            ${formatDate(order.startDate)} - ${formatDate(order.endDate)} | 
                            ${getWeekdaysText(order.daysOfWeek)} | 
                            ${order.timeSlots.length > 0 ? order.timeSlots.join(', ') : 'ช่วงเวลาใดก็ได้'}
                        </p>
                    </td>
                    <td class="p-2 text-center border border-slate-300">${order.totalDays}</td>
                    <td class="p-2 text-center border border-slate-300">${order.timesPerDay}</td>
                    <td class="p-2 text-right border border-slate-300 font-mono">${totalTimes}</td>
                    <td class="p-2 text-right border border-slate-300 font-mono">${unitPrice.toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>
                    <td class="p-2 text-right border border-slate-300 font-black">${orderTotal.toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>
                `;
                itemsContainer.appendChild(row);
            });
            
            // Add discount details if applicable
            const discountContainer = document.getElementById('quotation-discount-details');
            if (hasDiscount) {
                discountContainer.classList.remove('hidden');
                discountContainer.innerHTML = `
                    <p class="font-bold text-emerald-800 mb-2">*** รายละเอียดส่วนลด:</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm font-semibold">ส่วนลดเงื่อนไข:</p>
                            <ul class="text-sm pl-4">
                                <li>ลูกค้าประเภท ${customer.type}: ${customerOrders[0].conditionDiscountPercent}%</li>
                                <li>ระยะเวลาแคมเปญ: ${calculateCampaignDuration(customerOrders[0].startDate, customerOrders[0].endDate)}</li>
                            </ul>
                        </div>
                        <div>
                            <p class="text-sm font-semibold">ส่วนลดการชำระเงิน:</p>
                            <ul class="text-sm pl-4">
                                <li>${customerOrders[0].paymentType === 'ก่อนออกอากาศ' ? 'ชำระก่อนออกอากาศ: 5%' : 'ชำระหลังออกอากาศ: 0%'}</li>
                                <li>รวมส่วนลดทั้งหมด: ${(totalConditionDiscount + totalPaymentDiscount).toLocaleString(undefined, { minimumFractionDigits: 2 })} บาท</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else {
                discountContainer.classList.add('hidden');
            }
            
            // Update totals
            document.getElementById('quotation-before-vat').textContent = `${beforeVat.toLocaleString(undefined, { minimumFractionDigits: 2 })} บาท`;
            document.getElementById('quotation-vat').textContent = `${vat.toLocaleString(undefined, { minimumFractionDigits: 2 })} บาท`;
            document.getElementById('quotation-total').textContent = `${total.toLocaleString(undefined, { minimumFractionDigits: 2 })} บาท`;
            
            // Show preview
            document.getElementById('quotation-preview').classList.remove('hidden');
            document.getElementById('quotation-empty').classList.add('hidden');
        }
        
        function calculateCampaignDuration(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            const months = diffDays / 30;
            
            if (months >= 6) return '6 เดือนขึ้นไป (ส่วนลด 30%)';
            else if (months >= 3) return '3-6 เดือน (ส่วนลด 25%)';
            else if (months >= 2) return '2-3 เดือน (ส่วนลด 20%)';
            else return 'น้อยกว่า 2 เดือน (ไม่มีส่วนลด)';
        }
        
        function getWeekdaysText(daysArray) {
            const dayNames = ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส'];
            const thaiDays = daysArray.map(day => dayNames[day]).join(', ');
            return thaiDays;
        }
        
        function printQuotation() {
            const customerId = document.getElementById('quotation-customer').value;
            if (!customerId) {
                showNotification('กรุณาเลือกลูกค้าก่อนพิมพ์', 'error');
                return;
            }
            
            window.print();
        }
        
        // ========== UTILITY FUNCTIONS ==========
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }
        
        function updateLastSaved() {
            const lastSavedEl = document.getElementById('last-saved');
            if (systemData.settings.lastSave) {
                const date = new Date(systemData.settings.lastSave);
                lastSavedEl.textContent = `${date.toLocaleDateString('th-TH')} ${date.toLocaleTimeString('th-TH')}`;
            } else {
                lastSavedEl.textContent = 'ไม่เคยบันทึก';
            }
        }
        
        function updateMobileLastSaved() {
            const mobileLastSaved = document.getElementById('mobile-last-saved');
            if (mobileLastSaved && systemData.settings.lastSave) {
                const date = new Date(systemData.settings.lastSave);
                mobileLastSaved.textContent = `บันทึก: ${date.toLocaleTimeString('th-TH')}`;
            }
        }
        
        function updateBadges() {
            // Customer badge
            const customerBadge = document.getElementById('customer-badge');
            if (customerBadge) {
                customerBadge.textContent = systemData.customers.length;
                customerBadge.classList.toggle('hidden', systemData.customers.length === 0);
            }
            
            // Order badge
            const orderBadge = document.getElementById('order-badge');
            if (orderBadge) {
                orderBadge.textContent = systemData.orders.length;
                orderBadge.classList.toggle('hidden', systemData.orders.length === 0);
            }
        }
        
        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-medium z-50 animate-fadeIn ${
                type === 'success' ? 'bg-emerald-500' :
                type === 'error' ? 'bg-red-500' :
                'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function setupEventListeners() {
            // Quotation customer select
            const quotationCustomer = document.getElementById('quotation-customer');
            if (quotationCustomer) {
                quotationCustomer.addEventListener('change', loadCustomerQuotation);
            }
            
            const staffName = document.getElementById('staff-name');
            const staffPhone = document.getElementById('staff-phone');
            
            if (staffName) staffName.addEventListener('input', loadCustomerQuotation);
            if (staffPhone) staffPhone.addEventListener('input', loadCustomerQuotation);
        }
        
        function renderAll() {
            renderCustomers();
            renderProducts();
            populateQuotationCustomerSelect();
            updateOrdersTable();
            updateCampaignTotal();
        }
        
        // ========== INITIALIZE OTHER TABS ==========
        // Note: ฟังก์ชันอื่นๆ สำหรับ Customers, Products, Packages, Orders จะเหมือนโค้ดเดิม
        // เพื่อความกระชับ ขอละไว้ในที่นี้
        
        // ฟังก์ชันสำหรับหน้า Customers, Products, Packages, Orders
        // ... (โค้ดเดิมทั้งหมด) ...
        
    </script>
</body>
</html>
